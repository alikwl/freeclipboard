<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FreeClipboard Studio | Image Creator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=Lobster&family=Montserrat:wght@400;700;900&family=Playfair+Display:ital,wght@0,700;1,400&family=Roboto+Mono:wght@400;700&family=Abril+Fatface&family=Bebas+Neue&display=swap"
        rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            touch-action: manipulation;
        }

        .custom-scroll::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        .custom-scroll::-webkit-scrollbar-track {
            background: #1e293b;
        }

        .custom-scroll::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 3px;
        }

        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }

        .check-pattern {
            background-color: #1e293b;
            background-image: linear-gradient(45deg, #0f172a 25%, transparent 25%), linear-gradient(-45deg, #0f172a 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #0f172a 75%), linear-gradient(-45deg, transparent 75%, #0f172a 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }

        input[type=range] {
            -webkit-appearance: none;
            appearance: none;
            background: transparent;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 14px;
            width: 14px;
            border-radius: 50%;
            background: #38bdf8;
            margin-top: -5px;
            box-shadow: 0 0 0 2px #0f172a;
            cursor: grab;
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            background: #334155;
            border-radius: 2px;
        }

        .device-phone {
            border: 14px solid #1e293b;
            border-radius: 40px;
            background: #000;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.6);
        }

        .device-phone::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 35%;
            height: 24px;
            background: #1e293b;
            border-bottom-left-radius: 12px;
            border-bottom-right-radius: 12px;
            z-index: 10;
        }

        .device-laptop {
            border: 12px solid #1e293b;
            border-bottom-width: 24px;
            border-radius: 12px 12px 0 0;
            background: #000;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.6);
        }

        @keyframes pop {
            0% {
                transform: scale(0.95);
                opacity: 0.8;
            }

            50% {
                transform: scale(1.02);
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .animate-pop {
            animation: pop 0.3s ease-out;
        }

        .section-header {
            cursor: pointer;
            user-select: none;
        }

        .section-content {
            transition: max-height 0.3s ease, opacity 0.2s ease, padding 0.2s ease;
            overflow: hidden;
        }

        .section-content.collapsed {
            max-height: 0 !important;
            opacity: 0;
            padding-top: 0 !important;
            padding-bottom: 0 !important;
        }

        .tooltip {
            position: relative;
        }

        .tooltip::after {
            content: attr(data-tip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) scale(0.8);
            background: #1e293b;
            color: #fff;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: all 0.2s;
            z-index: 100;
        }

        .tooltip:hover::after {
            opacity: 1;
            transform: translateX(-50%) scale(1);
        }

        .quick-btn {
            transition: all 0.15s;
        }

        .quick-btn:active {
            transform: scale(0.95);
        }

        .guide-line {
            position: absolute;
            background: #f472b6;
            pointer-events: none;
            z-index: 50;
        }

        .guide-h {
            height: 1px;
            width: 100%;
            left: 0;
        }

        .guide-v {
            width: 1px;
            height: 100%;
            top: 0;
        }

        .recent-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.15s;
        }

        .recent-color:hover {
            border-color: #38bdf8;
            transform: scale(1.1);
        }

        .fullscreen-preview {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @media (max-width: 768px) {
            .mobile-bottom-bar {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                z-index: 100;
            }
        }
    </style>
</head>

<body class="text-slate-200 h-screen flex flex-col md:flex-row overflow-hidden">

    <!-- QUICK ACTIONS TOOLBAR (Mobile-friendly floating bar) -->
    <div id="quickBar"
        class="fixed bottom-4 left-1/2 -translate-x-1/2 md:top-4 md:bottom-auto md:left-auto md:right-4 md:translate-x-0 z-50 flex gap-1 bg-slate-800/95 backdrop-blur p-1.5 rounded-full shadow-2xl border border-slate-700">
        <button onclick="undo()" class="quick-btn p-2 hover:bg-slate-700 rounded-full tooltip"
            data-tip="Undo (Ctrl+Z)"><i class="ph-bold ph-arrow-u-up-left"></i></button>
        <button onclick="redo()" class="quick-btn p-2 hover:bg-slate-700 rounded-full tooltip"
            data-tip="Redo (Ctrl+Y)"><i class="ph-bold ph-arrow-u-up-right"></i></button>
        <div class="w-px bg-slate-600 mx-1"></div>
        <button onclick="copyToClipboard()" class="quick-btn p-2 hover:bg-slate-700 rounded-full tooltip"
            data-tip="Copy (Ctrl+C)"><i class="ph-bold ph-copy"></i></button>
        <button onclick="download()" class="quick-btn p-2 hover:bg-slate-700 rounded-full tooltip"
            data-tip="Download (Ctrl+S)"><i class="ph-bold ph-download-simple"></i></button>
        <button onclick="toggleFullscreen()" class="quick-btn p-2 hover:bg-slate-700 rounded-full tooltip"
            data-tip="Fullscreen (F)"><i class="ph-bold ph-arrows-out"></i></button>
        <div class="w-px bg-slate-600 mx-1"></div>
        <button onclick="toggleGuides()" id="guidesBtn" class="quick-btn p-2 hover:bg-slate-700 rounded-full tooltip"
            data-tip="Guides (G)"><i class="ph-bold ph-grid-four"></i></button>
        <button onclick="remix()"
            class="quick-btn p-2 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full tooltip"
            data-tip="Remix (R)"><i class="ph-bold ph-magic-wand"></i></button>
    </div>

    <!-- FULLSCREEN PREVIEW MODAL -->
    <div id="fullscreenModal" class="fullscreen-preview hidden">
        <button onclick="toggleFullscreen()"
            class="absolute top-4 right-4 p-3 bg-slate-800 rounded-full hover:bg-slate-700"><i
                class="ph-bold ph-x text-xl"></i></button>
        <canvas id="fullscreenCanvas"></canvas>
    </div>

    <!-- LEFT SIDEBAR -->
    <div
        class="w-full md:w-[400px] bg-slate-900 border-r border-slate-800 flex flex-col z-20 flex-shrink-0 h-[50vh] md:h-full shadow-2xl relative">
        <!-- Header -->
        <div class="p-4 border-b border-slate-800 bg-slate-900 sticky top-0 z-30 flex items-center justify-between">
            <div class="flex items-center gap-2.5">
                <div
                    class="w-9 h-9 rounded-lg bg-sky-500 flex items-center justify-center text-white shadow-lg shadow-sky-500/20">
                    <i class="ph-bold ph-clipboard-text text-xl"></i>
                </div>
                <div>
                    <h1 class="font-bold text-base leading-tight text-white tracking-tight">FreeClipboard</h1>
                    <div class="text-[10px] text-sky-400 font-mono tracking-widest uppercase">Studio Editor</div>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <button onclick="resetToDefault()"
                    class="p-1.5 hover:text-white text-slate-400 rounded hover:bg-slate-700 transition tooltip"
                    data-tip="Reset"><i class="ph-bold ph-arrow-counter-clockwise"></i></button>
                <button onclick="showProjectModal('save')"
                    class="p-1.5 hover:text-white text-slate-400 rounded hover:bg-slate-700 transition tooltip"
                    data-tip="Save Project"><i class="ph-bold ph-floppy-disk"></i></button>
                <button onclick="showProjectModal('load')"
                    class="p-1.5 hover:text-white text-slate-400 rounded hover:bg-slate-700 transition tooltip"
                    data-tip="Load Project"><i class="ph-bold ph-folder-open"></i></button>
            </div>
        </div>

        <!-- Controls Scroll Area -->
        <div class="flex-1 overflow-y-auto custom-scroll p-5 space-y-4" id="controlsArea">

            <!-- Templates Section -->
            <section class="space-y-2">
                <div class="section-header flex items-center justify-between" onclick="toggleSection(this)">
                    <h2 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest flex items-center gap-1">
                        <i class="ph-fill ph-layout text-sky-400"></i> Templates</h2>
                    <i class="ph ph-caret-down text-slate-500 transition-transform"></i>
                </div>
                <div class="section-content grid grid-cols-2 gap-2">
                    <button onclick="loadTemplate('social-promo')"
                        class="p-2 bg-slate-800 hover:bg-slate-700 rounded border border-slate-700 text-left group transition">
                        <div class="text-[10px] font-bold text-white group-hover:text-sky-400">üöÄ Promo</div>
                        <div class="text-[9px] text-slate-500">Square ‚Ä¢ Vibrant</div>
                    </button>
                    <button onclick="loadTemplate('quote-card')"
                        class="p-2 bg-slate-800 hover:bg-slate-700 rounded border border-slate-700 text-left group transition">
                        <div class="text-[10px] font-bold text-white group-hover:text-sky-400">‚ú® Quote</div>
                        <div class="text-[9px] text-slate-500">Twitter ‚Ä¢ Elegant</div>
                    </button>
                    <button onclick="loadTemplate('announcement')"
                        class="p-2 bg-slate-800 hover:bg-slate-700 rounded border border-slate-700 text-left group transition">
                        <div class="text-[10px] font-bold text-white group-hover:text-sky-400">üì£ News</div>
                        <div class="text-[9px] text-slate-500">Link ‚Ä¢ Bold</div>
                    </button>
                    <button onclick="loadTemplate('minimal')"
                        class="p-2 bg-slate-800 hover:bg-slate-700 rounded border border-slate-700 text-left group transition">
                        <div class="text-[10px] font-bold text-white group-hover:text-sky-400">‚ö™ Minimal</div>
                        <div class="text-[9px] text-slate-500">Clean ‚Ä¢ Dark</div>
                    </button>
                    <button onclick="loadTemplate('gradient-burst')"
                        class="p-2 bg-slate-800 hover:bg-slate-700 rounded border border-slate-700 text-left group transition">
                        <div class="text-[10px] font-bold text-white group-hover:text-sky-400">üåà Gradient</div>
                        <div class="text-[9px] text-slate-500">Story ‚Ä¢ Colorful</div>
                    </button>
                    <button onclick="loadTemplate('dark-tech')"
                        class="p-2 bg-slate-800 hover:bg-slate-700 rounded border border-slate-700 text-left group transition">
                        <div class="text-[10px] font-bold text-white group-hover:text-sky-400">üíª Tech</div>
                        <div class="text-[9px] text-slate-500">Wide ‚Ä¢ Modern</div>
                    </button>
                </div>
            </section>

            <!-- Canvas Dimensions -->
            <section class="space-y-3 pt-2 border-t border-slate-800/50">
                <div class="section-header flex items-center justify-between" onclick="toggleSection(this)">
                    <h2 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest flex items-center gap-1">
                        <i class="ph-fill ph-frame-corners text-green-400"></i> Canvas</h2>
                    <div class="flex items-center gap-2">
                        <span id="dimLabel"
                            class="text-[9px] font-mono text-sky-400 bg-sky-900/20 px-1.5 py-0.5 rounded">1200x630</span>
                        <i class="ph ph-caret-down text-slate-500 transition-transform"></i>
                    </div>
                </div>
                <div class="section-content space-y-3">
                    <div class="grid grid-cols-4 gap-1.5">
                        <button onclick="setSize(1080,1080)"
                            class="px-1.5 py-1 bg-slate-800 rounded text-[9px] text-slate-300 hover:bg-slate-700 border border-slate-700 tooltip"
                            data-tip="Instagram Post">Square</button>
                        <button onclick="setSize(1080,1920)"
                            class="px-1.5 py-1 bg-slate-800 rounded text-[9px] text-slate-300 hover:bg-slate-700 border border-slate-700 tooltip"
                            data-tip="Instagram Story">Story</button>
                        <button onclick="setSize(1200,630)"
                            class="px-1.5 py-1 bg-slate-800 rounded text-[9px] text-slate-300 hover:bg-slate-700 border border-slate-700 tooltip"
                            data-tip="Open Graph">OG</button>
                        <button onclick="setSize(1200,675)"
                            class="px-1.5 py-1 bg-slate-800 rounded text-[9px] text-slate-300 hover:bg-slate-700 border border-slate-700 tooltip"
                            data-tip="YouTube Thumbnail">YouTube</button>
                        <button onclick="setSize(1080,566)"
                            class="px-1.5 py-1 bg-slate-800 rounded text-[9px] text-slate-300 hover:bg-slate-700 border border-slate-700 tooltip"
                            data-tip="Twitter Post">Twitter</button>
                        <button onclick="setSize(1500,500)"
                            class="px-1.5 py-1 bg-slate-800 rounded text-[9px] text-slate-300 hover:bg-slate-700 border border-slate-700 tooltip"
                            data-tip="LinkedIn Banner">LinkedIn</button>
                        <button onclick="setSize(1920,1080)"
                            class="px-1.5 py-1 bg-slate-800 rounded text-[9px] text-slate-300 hover:bg-slate-700 border border-slate-700 tooltip"
                            data-tip="HD Wallpaper">HD</button>
                        <button onclick="setSize(2560,1440)"
                            class="px-1.5 py-1 bg-slate-800 rounded text-[9px] text-slate-300 hover:bg-slate-700 border border-slate-700 tooltip"
                            data-tip="2K Resolution">2K</button>
                        <button onclick="setSize(820,312)"
                            class="px-1.5 py-1 bg-slate-800 rounded text-[9px] text-slate-300 hover:bg-slate-700 border border-slate-700 tooltip"
                            data-tip="Facebook Cover">FB Cover</button>
                        <button onclick="setSize(1584,396)"
                            class="px-1.5 py-1 bg-slate-800 rounded text-[9px] text-slate-300 hover:bg-slate-700 border border-slate-700 tooltip"
                            data-tip="LinkedIn Cover">LI Cover</button>
                        <button onclick="setSize(1280,720)"
                            class="px-1.5 py-1 bg-slate-800 rounded text-[9px] text-slate-300 hover:bg-slate-700 border border-slate-700 tooltip"
                            data-tip="720p Video">720p</button>
                        <button onclick="setSize(800,600)"
                            class="px-1.5 py-1 bg-slate-800 rounded text-[9px] text-slate-300 hover:bg-slate-700 border border-slate-700 tooltip"
                            data-tip="Presentation">4:3</button>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <div class="relative">
                            <i
                                class="ph ph-arrows-out-line-horizontal absolute left-2 top-2 text-slate-500 text-xs"></i>
                            <input id="inpW" type="number" value="1200"
                                class="w-full bg-slate-900 border border-slate-700 rounded py-1.5 pl-7 pr-2 text-xs text-white focus:border-sky-500 focus:outline-none">
                        </div>
                        <div class="relative">
                            <i class="ph ph-arrows-out-line-vertical absolute left-2 top-2 text-slate-500 text-xs"></i>
                            <input id="inpH" type="number" value="630"
                                class="w-full bg-slate-900 border border-slate-700 rounded py-1.5 pl-7 pr-2 text-xs text-white focus:border-sky-500 focus:outline-none">
                        </div>
                    </div>
                    <label class="flex items-center gap-2 text-[10px] text-slate-400">
                        <input type="checkbox" id="lockRatio" class="rounded bg-slate-700">
                        <i class="ph ph-lock-simple"></i> Lock aspect ratio
                    </label>
                </div>
            </section>

            <!-- Background Section -->
            <section class="space-y-4 pt-2 border-t border-slate-800/50">
                <div class="section-header flex items-center justify-between" onclick="toggleSection(this)">
                    <h2 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest flex items-center gap-1">
                        <i class="ph-fill ph-paint-bucket text-purple-400"></i> Background</h2>
                    <div class="flex items-center gap-2">
                        <label class="relative inline-flex items-center cursor-pointer"
                            onclick="event.stopPropagation()">
                            <input type="checkbox" id="vis-bg" class="sr-only peer" checked
                                onchange="toggleLayer('background')">
                            <div
                                class="w-6 h-3.5 bg-slate-700 rounded-full peer peer-checked:bg-sky-500 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-2.5 after:w-2.5 after:transition-all">
                            </div>
                        </label>
                        <i class="ph ph-caret-down text-slate-500 transition-transform"></i>
                    </div>
                </div>
                <div class="section-content space-y-4">
                    <!-- Color Palette Generator -->
                    <div>
                        <div class="flex items-center justify-between mb-2">
                            <label class="text-[9px] text-slate-500">Color Palette</label>
                            <button onclick="generatePalette()"
                                class="text-[9px] text-sky-400 hover:text-sky-300 flex items-center gap-1"><i
                                    class="ph ph-shuffle"></i> Generate</button>
                        </div>
                        <div id="paletteColors" class="flex gap-1 mb-2">
                            <div class="recent-color" style="background:#0f172a"
                                onclick="applyPaletteColor(this, 'c1')"></div>
                            <div class="recent-color" style="background:#38bdf8"
                                onclick="applyPaletteColor(this, 'c2')"></div>
                            <div class="recent-color" style="background:#f472b6"
                                onclick="applyPaletteColor(this, 'c1')"></div>
                            <div class="recent-color" style="background:#a78bfa"
                                onclick="applyPaletteColor(this, 'c2')"></div>
                            <div class="recent-color" style="background:#34d399"
                                onclick="applyPaletteColor(this, 'c1')"></div>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-[9px] text-slate-500 mb-1 block">Primary</label>
                            <div class="flex gap-2">
                                <input type="color" id="c1" value="#0f172a"
                                    class="w-8 h-8 rounded bg-transparent cursor-pointer border border-slate-600 p-0.5">
                                <input type="text" id="hex1" value="#0f172a"
                                    class="flex-1 bg-slate-800 border border-slate-700 rounded px-2 text-[10px] font-mono text-slate-300">
                            </div>
                        </div>
                        <div>
                            <label class="text-[9px] text-slate-500 mb-1 block">Secondary</label>
                            <div class="flex gap-2">
                                <input type="color" id="c2" value="#38bdf8"
                                    class="w-8 h-8 rounded bg-transparent cursor-pointer border border-slate-600 p-0.5">
                                <input type="text" id="hex2" value="#38bdf8"
                                    class="flex-1 bg-slate-800 border border-slate-700 rounded px-2 text-[10px] font-mono text-slate-300">
                            </div>
                        </div>
                    </div>
                    <!-- Recent Colors -->
                    <div>
                        <label class="text-[9px] text-slate-500 mb-1.5 block">Recent Colors</label>
                        <div id="recentColors" class="flex gap-1 flex-wrap"></div>
                    </div>
                    <div>
                        <label class="text-[9px] text-slate-500 mb-1.5 block">Pattern Overlay</label>
                        <select id="pattern"
                            class="w-full bg-slate-800 border border-slate-700 rounded px-2 py-2 text-xs text-white focus:border-sky-500 focus:outline-none">
                            <option value="blobs">Abstract Blobs</option>
                            <option value="gradient">Linear Gradient</option>
                            <option value="radial">Radial Gradient</option>
                            <option value="grid">Grid</option>
                            <option value="dots">Dots</option>
                            <option value="stripes">Stripes</option>
                            <option value="solid">Solid</option>
                            <option value="noise">Noise</option>
                            <option value="waves">Waves</option>
                            <option value="hexagons">Hexagons</option>
                            <option value="zigzag">Zigzag</option>
                            <option value="chevron">Chevron</option>
                            <option value="crosshatch">Crosshatch</option>
                            <option value="confetti">Confetti</option>
                            <option value="circles">Circles</option>
                            <option value="diagonal">Diagonal</option>
                        </select>
                    </div>
                    <!-- Gradient Builder -->
                    <div id="gradientBuilder" class="space-y-2 hidden">
                        <label class="text-[9px] text-slate-500 block">Gradient Angle</label>
                        <input type="range" id="gradAngle" min="0" max="360" value="45" class="w-full">
                        <div class="flex items-center gap-2">
                            <span class="text-[9px] text-slate-400" id="gradAngleVal">45¬∞</span>
                            <button onclick="addGradientStop()" class="text-[9px] text-sky-400 hover:text-sky-300">+ Add
                                Stop</button>
                        </div>
                        <div id="gradientStops" class="space-y-1"></div>
                    </div>
                    <!-- Image Upload -->
                    <div>
                        <label class="text-[9px] text-slate-500 mb-1.5 block">Upload Background Image</label>
                        <input type="file" id="bgUpload" accept="image/*"
                            class="w-full text-[10px] text-slate-400 file:mr-2 file:py-1 file:px-2 file:rounded-md file:border-0 file:text-[10px] file:bg-slate-700 file:text-white hover:file:bg-slate-600">
                        <div class="mt-2" id="bgImageControls" style="display:none;">
                            <button onclick="clearBgImage()"
                                class="text-[9px] text-red-400 hover:text-red-300 mb-2">Remove Image</button>
                            <div class="flex gap-2 items-center mb-1">
                                <span class="text-[9px] w-10">Opacity</span>
                                <input type="range" id="bgImgOp" min="0" max="100" value="50" class="flex-1">
                            </div>
                            <div class="flex gap-2 items-center">
                                <span class="text-[9px] w-10">Scale</span>
                                <input type="range" id="bgImgScale" min="10" max="200" value="100" class="flex-1">
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Layers Panel -->
            <section class="space-y-3 pt-2 border-t border-slate-800/50">
                <div class="section-header flex items-center justify-between" onclick="toggleSection(this)">
                    <h2 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest flex items-center gap-1">
                        <i class="ph-fill ph-stack text-yellow-400"></i> Layers</h2>
                    <i class="ph ph-caret-down text-slate-500 transition-transform"></i>
                </div>
                <div class="section-content space-y-1">
                    <div
                        class="flex items-center justify-between p-2 bg-slate-800/50 rounded border border-slate-700/50">
                        <span class="text-[10px] flex items-center gap-2"><i
                                class="ph ph-paint-bucket text-purple-400"></i> Background</span>
                        <div class="flex items-center gap-2">
                            <button onclick="duplicateLayer('background')"
                                class="text-slate-500 hover:text-white tooltip" data-tip="Duplicate"><i
                                    class="ph ph-copy-simple text-xs"></i></button>
                            <input type="checkbox" id="layer-bg" checked onchange="toggleLayer('background')"
                                class="rounded bg-slate-700">
                        </div>
                    </div>
                    <div
                        class="flex items-center justify-between p-2 bg-slate-800/50 rounded border border-slate-700/50">
                        <span class="text-[10px] flex items-center gap-2"><i class="ph ph-image text-blue-400"></i> BG
                            Image</span>
                        <div class="flex items-center gap-2">
                            <input type="checkbox" id="layer-bgimg" checked onchange="toggleLayer('bgImage')"
                                class="rounded bg-slate-700">
                        </div>
                    </div>
                    <div
                        class="flex items-center justify-between p-2 bg-slate-800/50 rounded border border-slate-700/50">
                        <span class="text-[10px] flex items-center gap-2"><i class="ph ph-shapes text-orange-400"></i>
                            Shapes</span>
                        <div class="flex items-center gap-2">
                            <button onclick="duplicateLayer('shapes')" class="text-slate-500 hover:text-white tooltip"
                                data-tip="Duplicate All"><i class="ph ph-copy-simple text-xs"></i></button>
                            <input type="checkbox" id="layer-shapes" checked onchange="toggleLayer('shapes')"
                                class="rounded bg-slate-700">
                        </div>
                    </div>
                    <div
                        class="flex items-center justify-between p-2 bg-slate-800/50 rounded border border-slate-700/50">
                        <span class="text-[10px] flex items-center gap-2"><i class="ph ph-sticker text-pink-400"></i>
                            Icon</span>
                        <div class="flex items-center gap-2">
                            <button onclick="duplicateLayer('icon')" class="text-slate-500 hover:text-white tooltip"
                                data-tip="Duplicate"><i class="ph ph-copy-simple text-xs"></i></button>
                            <input type="checkbox" id="layer-icon" checked onchange="toggleLayer('icon')"
                                class="rounded bg-slate-700">
                        </div>
                    </div>
                    <div
                        class="flex items-center justify-between p-2 bg-slate-800/50 rounded border border-slate-700/50">
                        <span class="text-[10px] flex items-center gap-2"><i class="ph ph-text-t text-green-400"></i>
                            Text 1</span>
                        <div class="flex items-center gap-2">
                            <button onclick="duplicateLayer('text1')" class="text-slate-500 hover:text-white tooltip"
                                data-tip="Duplicate"><i class="ph ph-copy-simple text-xs"></i></button>
                            <input type="checkbox" id="layer-text1" checked onchange="toggleLayer('text1')"
                                class="rounded bg-slate-700">
                        </div>
                    </div>
                    <div
                        class="flex items-center justify-between p-2 bg-slate-800/50 rounded border border-slate-700/50">
                        <span class="text-[10px] flex items-center gap-2"><i class="ph ph-text-aa text-teal-400"></i>
                            Text 2</span>
                        <div class="flex items-center gap-2">
                            <button onclick="duplicateLayer('text2')" class="text-slate-500 hover:text-white tooltip"
                                data-tip="Duplicate"><i class="ph ph-copy-simple text-xs"></i></button>
                            <input type="checkbox" id="layer-text2" checked onchange="toggleLayer('text2')"
                                class="rounded bg-slate-700">
                        </div>
                    </div>
                    <div
                        class="flex items-center justify-between p-2 bg-slate-800/50 rounded border border-slate-700/50">
                        <span class="text-[10px] flex items-center gap-2"><i class="ph ph-drop text-cyan-400"></i>
                            Watermark</span>
                        <div class="flex items-center gap-2">
                            <input type="checkbox" id="layer-wm" checked onchange="toggleLayer('watermark')"
                                class="rounded bg-slate-700">
                        </div>
                    </div>
                </div>
            </section>

            <!-- Shape Library -->
            <section class="space-y-4 pt-2 border-t border-slate-800/50">
                <div class="section-header flex items-center justify-between" onclick="toggleSection(this)">
                    <h2 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest flex items-center gap-1">
                        <i class="ph-fill ph-shapes text-orange-400"></i> Shapes</h2>
                    <div class="flex items-center gap-2">
                        <button onclick="clearShapes()" class="text-[9px] text-red-400 hover:text-red-300"
                            onclick="event.stopPropagation()">Clear</button>
                        <i class="ph ph-caret-down text-slate-500 transition-transform"></i>
                    </div>
                </div>
                <div class="section-content space-y-3">
                    <div class="grid grid-cols-6 gap-1.5">
                        <button onclick="addShape('circle')"
                            class="p-2 bg-slate-800 hover:bg-slate-700 rounded border border-slate-700 flex justify-center tooltip"
                            data-tip="Circle">
                            <div class="w-4 h-4 rounded-full bg-slate-400"></div>
                        </button>
                        <button onclick="addShape('square')"
                            class="p-2 bg-slate-800 hover:bg-slate-700 rounded border border-slate-700 flex justify-center tooltip"
                            data-tip="Square">
                            <div class="w-4 h-4 bg-slate-400"></div>
                        </button>
                        <button onclick="addShape('triangle')"
                            class="p-2 bg-slate-800 hover:bg-slate-700 rounded border border-slate-700 flex justify-center tooltip"
                            data-tip="Triangle">
                            <div
                                class="w-0 h-0 border-l-[8px] border-l-transparent border-r-[8px] border-r-transparent border-b-[14px] border-b-slate-400">
                            </div>
                        </button>
                        <button onclick="addShape('star')"
                            class="p-2 bg-slate-800 hover:bg-slate-700 rounded border border-slate-700 flex justify-center text-slate-400 text-sm tooltip"
                            data-tip="Star"><i class="ph-fill ph-star"></i></button>
                        <button onclick="addShape('hexagon')"
                            class="p-2 bg-slate-800 hover:bg-slate-700 rounded border border-slate-700 flex justify-center text-slate-400 text-sm tooltip"
                            data-tip="Hexagon"><i class="ph-fill ph-hexagon"></i></button>
                        <button onclick="addShape('diamond')"
                            class="p-2 bg-slate-800 hover:bg-slate-700 rounded border border-slate-700 flex justify-center text-slate-400 text-sm tooltip"
                            data-tip="Diamond"><i class="ph-fill ph-diamond"></i></button>
                        <button onclick="addShape('heart')"
                            class="p-2 bg-slate-800 hover:bg-slate-700 rounded border border-slate-700 flex justify-center text-slate-400 text-sm tooltip"
                            data-tip="Heart"><i class="ph-fill ph-heart"></i></button>
                        <button onclick="addShape('lightning')"
                            class="p-2 bg-slate-800 hover:bg-slate-700 rounded border border-slate-700 flex justify-center text-slate-400 text-sm tooltip"
                            data-tip="Lightning"><i class="ph-fill ph-lightning"></i></button>
                        <button onclick="addShape('cross')"
                            class="p-2 bg-slate-800 hover:bg-slate-700 rounded border border-slate-700 flex justify-center text-slate-400 text-sm tooltip"
                            data-tip="Cross"><i class="ph-bold ph-plus"></i></button>
                        <button onclick="addShape('ring')"
                            class="p-2 bg-slate-800 hover:bg-slate-700 rounded border border-slate-700 flex justify-center text-slate-400 text-sm tooltip"
                            data-tip="Ring"><i class="ph ph-circle"></i></button>
                        <button onclick="addShape('arrow')"
                            class="p-2 bg-slate-800 hover:bg-slate-700 rounded border border-slate-700 flex justify-center text-slate-400 text-sm tooltip"
                            data-tip="Arrow"><i class="ph-fill ph-arrow-right"></i></button>
                        <button onclick="addShape('blob')"
                            class="p-2 bg-slate-800 hover:bg-slate-700 rounded border border-slate-700 flex justify-center text-slate-400 text-sm tooltip"
                            data-tip="Blob"><i class="ph-fill ph-drop"></i></button>
                    </div>
                    <div id="shapeControls"
                        class="space-y-2 hidden bg-slate-800/50 p-3 rounded border border-slate-700">
                        <div class="flex items-center justify-between">
                            <p class="text-[9px] text-slate-400">Editing Shape <span id="shapeIndex"></span></p>
                            <button onclick="deleteActiveShape()" class="text-[9px] text-red-400 hover:text-red-300"><i
                                    class="ph ph-trash"></i> Delete</button>
                        </div>
                        <div class="flex gap-2 items-center">
                            <input type="color" id="shapeCol" value="#ffffff"
                                class="w-6 h-6 rounded bg-transparent border border-slate-600 p-0.5">
                            <input type="range" id="shapeSize" min="10" max="500" value="100" class="flex-1">
                            <span class="text-[9px] text-slate-500 w-8" id="shapeSizeVal">100</span>
                        </div>
                        <div class="flex gap-2 items-center">
                            <span class="text-[9px] w-6">Rot</span>
                            <input type="range" id="shapeRot" min="0" max="360" value="0" class="flex-1">
                        </div>
                        <div class="flex gap-2 items-center">
                            <span class="text-[9px] w-6">X</span>
                            <input type="range" id="shapeX" min="0" max="100" value="50" class="flex-1">
                        </div>
                        <div class="flex gap-2 items-center">
                            <span class="text-[9px] w-6">Y</span>
                            <input type="range" id="shapeY" min="0" max="100" value="50" class="flex-1">
                        </div>
                        <div class="flex gap-2 items-center">
                            <span class="text-[9px] w-6">Blur</span>
                            <input type="range" id="shapeBlur" min="0" max="50" value="0" class="flex-1">
                        </div>
                        <div class="flex gap-2 items-center">
                            <span class="text-[9px] w-6">Glow</span>
                            <input type="range" id="shapeGlow" min="0" max="50" value="0" class="flex-1">
                        </div>
                    </div>
                </div>
            </section>

            <!-- Icon Layer -->
            <section class="space-y-4 pt-2 border-t border-slate-800/50">
                <div class="section-header flex items-center justify-between" onclick="toggleSection(this)">
                    <h2 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest flex items-center gap-1">
                        <i class="ph-fill ph-sticker text-pink-400"></i> Icon</h2>
                    <div class="flex items-center gap-2">
                        <label class="relative inline-flex items-center cursor-pointer"
                            onclick="event.stopPropagation()">
                            <input type="checkbox" id="showIcon" class="sr-only peer" checked>
                            <div
                                class="w-6 h-3.5 bg-slate-700 rounded-full peer peer-checked:bg-pink-500 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-2.5 after:w-2.5 after:transition-all">
                            </div>
                        </label>
                        <i class="ph ph-caret-down text-slate-500 transition-transform"></i>
                    </div>
                </div>
                <div class="section-content space-y-3" id="iconControls">
                    <div class="grid grid-cols-[1fr_auto] gap-2">
                        <select id="iconSelect"
                            class="bg-slate-800 border border-slate-700 rounded px-2 py-1.5 text-lg text-white">
                            <option value="üìã">üìã</option>
                            <option value="üî•">üî•</option>
                            <option value="‚ú®">‚ú®</option>
                            <option value="‚ù§Ô∏è">‚ù§Ô∏è</option>
                            <option value="‚úÖ">‚úÖ</option>
                            <option value="üöÄ">üöÄ</option>
                            <option value="üí°">üí°</option>
                            <option value="üîî">üîî</option>
                            <option value="‚úÇÔ∏è">‚úÇÔ∏è</option>
                            <option value="‚≠ê">‚≠ê</option>
                            <option value="üíª">üíª</option>
                            <option value="üéâ">üéâ</option>
                            <option value="üé®">üé®</option>
                            <option value="üì±">üì±</option>
                            <option value="üéØ">üéØ</option>
                            <option value="üíé">üíé</option>
                            <option value="üåü">üåü</option>
                            <option value="‚ö°">‚ö°</option>
                            <option value="üîÆ">üîÆ</option>
                            <option value="üé™">üé™</option>
                        </select>
                        <input type="color" id="iconColor" value="#ffffff"
                            class="w-10 h-full rounded border border-slate-700 bg-transparent p-0.5 cursor-pointer">
                    </div>
                    <div class="flex items-center gap-2"><span class="text-[9px] text-slate-500 w-6">Size</span><input
                            type="range" id="iconSize" min="20" max="400" value="150" class="flex-1"></div>
                    <div class="flex items-center gap-2"><span class="text-[9px] text-slate-500 w-6">X</span><input
                            type="range" id="iconX" min="0" max="100" value="85" class="flex-1"></div>
                    <div class="flex items-center gap-2"><span class="text-[9px] text-slate-500 w-6">Y</span><input
                            type="range" id="iconY" min="0" max="100" value="15" class="flex-1"></div>
                    <div class="flex items-center gap-2"><span class="text-[9px] text-slate-500 w-6">Shadow</span><input
                            type="range" id="iconShadow" min="0" max="50" value="20" class="flex-1"></div>
                </div>
            </section>

            <!-- Typography -->
            <section class="space-y-4 pt-2 border-t border-slate-800/50">
                <div class="section-header flex items-center justify-between" onclick="toggleSection(this)">
                    <h2 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest flex items-center gap-1">
                        <i class="ph-fill ph-text-t text-green-400"></i> Typography</h2>
                    <div class="flex items-center gap-2">
                        <select id="font"
                            class="bg-slate-800 border border-slate-700 rounded px-2 py-1 text-[10px] text-white w-24"
                            onclick="event.stopPropagation()">
                            <option value="Inter">Inter</option>
                            <option value="Montserrat">Montserrat</option>
                            <option value="Abril Fatface">Abril</option>
                            <option value="Bebas Neue">Bebas</option>
                            <option value="Playfair Display">Playfair</option>
                            <option value="Lobster">Lobster</option>
                            <option value="Roboto Mono">Mono</option>
                        </select>
                        <i class="ph ph-caret-down text-slate-500 transition-transform"></i>
                    </div>
                </div>
                <div class="section-content space-y-4">
                    <!-- Text 1 -->
                    <div class="bg-slate-800/50 p-3 rounded-lg border border-slate-800">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-[9px] text-slate-500 uppercase">Text 1 (Main)</span>
                            <div class="flex gap-1">
                                <button onclick="setTextAlign(1,'left')" id="align1-left"
                                    class="p-1 hover:bg-slate-700 rounded text-slate-400 tooltip" data-tip="Left"><i
                                        class="ph ph-text-align-left text-xs"></i></button>
                                <button onclick="setTextAlign(1,'center')" id="align1-center"
                                    class="p-1 bg-slate-700 rounded text-white tooltip" data-tip="Center"><i
                                        class="ph ph-text-align-center text-xs"></i></button>
                                <button onclick="setTextAlign(1,'right')" id="align1-right"
                                    class="p-1 hover:bg-slate-700 rounded text-slate-400 tooltip" data-tip="Right"><i
                                        class="ph ph-text-align-right text-xs"></i></button>
                            </div>
                        </div>
                        <input type="text" id="t1" value="FreeClipboard"
                            class="w-full bg-transparent border-b border-slate-700 pb-1 mb-2 text-sm font-bold text-white focus:outline-none focus:border-sky-500">
                        <div class="flex items-center gap-2 mb-2">
                            <input type="color" id="tc1" value="#ffffff"
                                class="w-5 h-5 rounded border-none p-0 bg-transparent">
                            <input type="range" id="ts1" min="20" max="200" value="90" class="flex-1">
                            <label class="flex items-center gap-1"><input type="checkbox" id="th1"
                                    class="rounded bg-slate-700"><span class="text-[9px]">Box</span></label>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-[9px] text-slate-500 w-4">Y</span>
                            <input type="range" id="ty1" min="0" max="100" value="45" class="flex-1">
                        </div>
                        <div class="flex items-center gap-2 mt-2">
                            <span class="text-[9px] text-slate-500 w-4">X</span>
                            <input type="range" id="tx1" min="0" max="100" value="50" class="flex-1">
                        </div>
                    </div>
                    <!-- Text 2 -->
                    <div class="bg-slate-800/50 p-3 rounded-lg border border-slate-800">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-[9px] text-slate-500 uppercase">Text 2 (Sub)</span>
                            <div class="flex gap-1">
                                <button onclick="setTextAlign(2,'left')" id="align2-left"
                                    class="p-1 hover:bg-slate-700 rounded text-slate-400 tooltip" data-tip="Left"><i
                                        class="ph ph-text-align-left text-xs"></i></button>
                                <button onclick="setTextAlign(2,'center')" id="align2-center"
                                    class="p-1 bg-slate-700 rounded text-white tooltip" data-tip="Center"><i
                                        class="ph ph-text-align-center text-xs"></i></button>
                                <button onclick="setTextAlign(2,'right')" id="align2-right"
                                    class="p-1 hover:bg-slate-700 rounded text-slate-400 tooltip" data-tip="Right"><i
                                        class="ph ph-text-align-right text-xs"></i></button>
                            </div>
                        </div>
                        <input type="text" id="t2" value="Design Made Simple"
                            class="w-full bg-transparent border-b border-slate-700 pb-1 mb-2 text-xs text-slate-300 focus:outline-none focus:border-sky-500">
                        <div class="flex items-center gap-2 mb-2">
                            <input type="color" id="tc2" value="#94a3b8"
                                class="w-5 h-5 rounded border-none p-0 bg-transparent">
                            <input type="range" id="ts2" min="10" max="100" value="40" class="flex-1">
                            <label class="flex items-center gap-1"><input type="checkbox" id="th2"
                                    class="rounded bg-slate-700"><span class="text-[9px]">Box</span></label>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-[9px] text-slate-500 w-4">Y</span>
                            <input type="range" id="ty2" min="0" max="100" value="65" class="flex-1">
                        </div>
                        <div class="flex items-center gap-2 mt-2">
                            <span class="text-[9px] text-slate-500 w-4">X</span>
                            <input type="range" id="tx2" min="0" max="100" value="50" class="flex-1">
                        </div>
                    </div>
                    <!-- Text Effects -->
                    <div class="space-y-2 pt-2 border-t border-slate-700/50">
                        <p class="text-[9px] text-slate-500 uppercase">Text Effects</p>
                        <label class="flex items-center gap-2"><input type="checkbox" id="textStroke1"
                                class="rounded bg-slate-700"><span class="text-[9px] text-slate-400">Stroke (Text
                                1)</span></label>
                        <div class="flex gap-2 items-center">
                            <span class="text-[9px] w-10 text-slate-500">Width</span>
                            <input type="range" id="strokeWidth" min="1" max="10" value="2" class="flex-1">
                            <input type="color" id="strokeColor" value="#000000"
                                class="w-6 h-6 rounded bg-transparent border border-slate-600 p-0.5">
                        </div>
                        <div class="flex gap-2 items-center">
                            <span class="text-[9px] w-10 text-slate-500">Rot 1</span>
                            <input type="range" id="textRotation1" min="-45" max="45" value="0" class="flex-1">
                        </div>
                        <div class="flex gap-2 items-center">
                            <span class="text-[9px] w-10 text-slate-500">Rot 2</span>
                            <input type="range" id="textRotation2" min="-45" max="45" value="0" class="flex-1">
                        </div>
                        <div class="flex gap-2 items-center">
                            <span class="text-[9px] w-10 text-slate-500">Shadow</span>
                            <input type="range" id="textShadow" min="0" max="30" value="8" class="flex-1">
                        </div>
                    </div>
                </div>
            </section>

            <!-- Watermark -->
            <section class="space-y-3 pt-2 border-t border-slate-800/50">
                <div class="section-header flex items-center justify-between" onclick="toggleSection(this)">
                    <h2 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest flex items-center gap-1">
                        <i class="ph-fill ph-drop text-cyan-400"></i> Watermark</h2>
                    <div class="flex items-center gap-2">
                        <label class="relative inline-flex items-center cursor-pointer"
                            onclick="event.stopPropagation()">
                            <input type="checkbox" id="wmEnabled" class="sr-only peer" checked>
                            <div
                                class="w-6 h-3.5 bg-slate-700 rounded-full peer peer-checked:bg-sky-500 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-2.5 after:w-2.5 after:transition-all">
                            </div>
                        </label>
                        <i class="ph ph-caret-down text-slate-500 transition-transform"></i>
                    </div>
                </div>
                <div class="section-content space-y-2">
                    <input type="text" id="wmText" value="FreeClipboard.com"
                        class="w-full bg-slate-800 border border-slate-700 rounded px-2 py-1 text-[10px] text-white">
                    <div class="flex gap-2">
                        <select id="wmPos"
                            class="bg-slate-800 border border-slate-700 rounded text-[10px] text-white flex-1">
                            <option value="bottom-right">Bottom Right</option>
                            <option value="bottom-left">Bottom Left</option>
                            <option value="top-right">Top Right</option>
                            <option value="top-left">Top Left</option>
                            <option value="center">Center</option>
                        </select>
                        <input type="range" id="wmOp" min="0" max="100" value="15" class="flex-1" title="Opacity">
                    </div>
                    <div class="flex gap-2 items-center">
                        <span class="text-[9px] w-8 text-slate-500">Size</span>
                        <input type="range" id="wmSize" min="8" max="30" value="12" class="flex-1">
                    </div>
                </div>
            </section>

            <div class="h-10"></div>
        </div>

        <!-- Footer -->
        <div class="p-4 bg-slate-900 border-t border-slate-800">
            <div class="flex gap-2 mb-2">
                <input type="text" id="fname" value="design"
                    class="bg-slate-800 border border-slate-700 rounded px-3 text-xs flex-1 focus:text-white text-slate-400">
                <select id="fmt" class="bg-slate-800 border border-slate-700 rounded px-2 text-xs text-slate-300">
                    <option value="png">PNG</option>
                    <option value="jpeg">JPG</option>
                    <option value="webp">WEBP</option>
                </select>
            </div>
            <div id="jpegQualityWrap" class="hidden mb-2">
                <div class="flex items-center gap-2">
                    <span class="text-[9px] text-slate-500">Quality</span>
                    <input type="range" id="jpegQuality" min="10" max="100" value="90" class="flex-1">
                    <span class="text-[9px] text-slate-400" id="qualityVal">90%</span>
                </div>
            </div>
            <div class="flex gap-2">
                <button onclick="copyToClipboard()"
                    class="flex-1 bg-slate-700 hover:bg-slate-600 text-white font-bold py-2.5 rounded shadow-lg transition flex items-center justify-center gap-2 text-xs">
                    <i class="ph-bold ph-copy"></i> Copy
                </button>
                <button onclick="download()"
                    class="flex-1 bg-sky-600 hover:bg-sky-500 text-white font-bold py-2.5 rounded shadow-lg shadow-sky-600/20 transition flex items-center justify-center gap-2 text-xs">
                    <i class="ph-bold ph-download-simple"></i> Download
                </button>
            </div>
        </div>
    </div>

    <!-- PREVIEW AREA -->
    <div class="flex-1 bg-[#0b0f19] relative flex flex-col h-[50vh] md:h-full overflow-hidden">
        <div
            class="h-12 border-b border-slate-800 bg-slate-900/80 backdrop-blur flex items-center justify-center gap-2 px-4 z-30">
            <button onclick="setView('raw')" id="v-raw"
                class="px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider bg-white text-slate-900 transition">Raw</button>
            <button onclick="setView('phone')" id="v-phone"
                class="px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider text-slate-500 hover:text-white transition">Phone</button>
            <button onclick="setView('laptop')" id="v-laptop"
                class="px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider text-slate-500 hover:text-white transition">Laptop</button>
        </div>
        <div class="flex-1 relative overflow-hidden check-pattern flex items-center justify-center p-8 md:p-16"
            id="stage">
            <!-- Grid/Ruler Guides -->
            <div id="guides" class="absolute inset-0 pointer-events-none hidden">
                <div class="guide-line guide-h" style="top:50%"></div>
                <div class="guide-line guide-v" style="left:50%"></div>
                <div class="guide-line guide-h" style="top:33.33%; opacity:0.5"></div>
                <div class="guide-line guide-h" style="top:66.66%; opacity:0.5"></div>
                <div class="guide-line guide-v" style="left:33.33%; opacity:0.5"></div>
                <div class="guide-line guide-v" style="left:66.66%; opacity:0.5"></div>
            </div>
            <div id="mockupWrapper" class="relative shadow-2xl origin-center">
                <canvas id="canvas" class="block"></canvas>
            </div>
        </div>
    </div>

    <!-- Project Save/Load Modal -->
    <div id="projectModal" class="fixed inset-0 bg-black/80 z-[100] hidden flex items-center justify-center p-4">
        <div class="bg-slate-800 rounded-xl p-6 w-full max-w-md border border-slate-700 shadow-2xl">
            <div class="flex items-center justify-between mb-4">
                <h3 id="modalTitle" class="text-lg font-bold text-white">Save Project</h3>
                <button onclick="closeProjectModal()" class="p-1 hover:bg-slate-700 rounded"><i
                        class="ph ph-x text-slate-400"></i></button>
            </div>
            <div id="saveSection" class="space-y-4">
                <input type="text" id="projectName" placeholder="Project name"
                    class="w-full bg-slate-900 border border-slate-700 rounded px-3 py-2 text-sm text-white">
                <button onclick="saveProject()"
                    class="w-full bg-sky-600 hover:bg-sky-500 text-white font-bold py-2.5 rounded">Save as JSON</button>
            </div>
            <div id="loadSection" class="space-y-4 hidden">
                <input type="file" id="loadFile" accept=".json"
                    class="w-full text-sm text-slate-400 file:mr-2 file:py-2 file:px-4 file:rounded file:border-0 file:bg-slate-700 file:text-white">
                <button onclick="loadProject()"
                    class="w-full bg-sky-600 hover:bg-sky-500 text-white font-bold py-2.5 rounded">Load Project</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast"
        class="fixed bottom-20 left-1/2 -translate-x-1/2 bg-slate-800 text-white px-4 py-2 rounded-lg shadow-xl border border-slate-700 text-sm opacity-0 transition-opacity pointer-events-none z-[200]">
    </div>

    <script>
        // ============ STATE ============
        const STATE = {
            w: 1200, h: 630, aspectRatio: null,
            c1: '#0f172a', c2: '#38bdf8',
            pat: 'blobs',
            gradAngle: 45, gradStops: [{ pos: 0, col: '#0f172a' }, { pos: 100, col: '#38bdf8' }],
            icon: { show: true, char: 'üìã', size: 150, x: 85, y: 15, color: '#ffffff', shadow: 20 },
            font: 'Inter',
            t1: { text: 'FreeClipboard', size: 90, x: 50, y: 45, col: '#ffffff', hl: false, stroke: false, rotation: 0, align: 'center' },
            t2: { text: 'Design Made Simple', size: 40, x: 50, y: 65, col: '#94a3b8', hl: false, rotation: 0, align: 'center' },
            textShadow: 8,
            blobs: [],
            view: 'raw',
            watermark: { enabled: true, text: 'FreeClipboard.com', opacity: 15, position: 'bottom-right', size: 12 },
            layers: { background: true, pattern: true, bgImage: true, shapes: true, icon: true, text1: true, text2: true, watermark: true },
            shapes: [],
            activeShapeIndex: -1,
            bgImage: { img: null, opacity: 50, scale: 100 },
            textEffects: { strokeColor: '#000000', strokeWidth: 2 },
            guides: false,
            recentColors: []
        };

        const DEFAULT_STATE = JSON.parse(JSON.stringify(STATE));
        const HISTORY = { states: [], index: -1, max: 20 };

        const TEMPLATES = {
            'social-promo': { w: 1080, h: 1080, c1: '#4c1d95', c2: '#f472b6', pat: 'waves', font: 'Montserrat', icon: { show: true, char: 'üöÄ', size: 180, x: 80, y: 20, shadow: 25 }, t1: { text: 'LAUNCH DAY', col: '#fff', size: 100 }, t2: { text: 'Check it out', col: '#ddd', size: 45 } },
            'quote-card': { w: 1200, h: 630, c1: '#111827', c2: '#374151', pat: 'hexagons', font: 'Playfair Display', icon: { show: false }, t1: { text: '"Design is thinking"', size: 70, col: '#fff' }, t2: { text: '- Saul Bass', size: 40, col: '#9ca3af' } },
            'announcement': { w: 1200, h: 630, c1: '#b91c1c', c2: '#fca5a5', pat: 'stripes', font: 'Bebas Neue', icon: { show: true, char: 'üì£', size: 200, x: 90, y: 10, shadow: 30 }, t1: { text: 'BIG NEWS', col: '#fff', size: 120 }, t2: { text: 'Read More', col: '#fecaca', size: 50 } },
            'minimal': { w: 1080, h: 1080, c1: '#ffffff', c2: '#e5e7eb', pat: 'dots', font: 'Inter', icon: { show: true, char: '‚ö™', color: '#000', size: 120, shadow: 10 }, t1: { text: 'Minimal', col: '#000', size: 80 }, t2: { text: 'Less is more', col: '#666', size: 35 } },
            'gradient-burst': { w: 1080, h: 1920, c1: '#7c3aed', c2: '#f472b6', pat: 'gradient', font: 'Montserrat', icon: { show: true, char: '‚ú®', size: 200, x: 50, y: 25, shadow: 30 }, t1: { text: 'AMAZING', col: '#fff', size: 100, y: 50 }, t2: { text: 'Story Template', col: '#fce7f3', size: 40, y: 60 } },
            'dark-tech': { w: 1920, h: 1080, c1: '#0a0a0a', c2: '#22d3ee', pat: 'grid', font: 'Roboto Mono', icon: { show: true, char: 'üíª', size: 150, x: 85, y: 20, shadow: 20 }, t1: { text: 'TECH VIBES', col: '#22d3ee', size: 90 }, t2: { text: 'Innovation starts here', col: '#6b7280', size: 35 } }
        };

        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const wrapper = document.getElementById('mockupWrapper');

        // ============ INIT ============
        function init() {
            genBlobs();
            bindInputs();
            bindKeyboard();
            saveState();
            window.addEventListener('resize', fit);
            draw();
            fit();
            updateRecentColorsUI();
        }

        // ============ DRAW ============
        function draw() {
            if (canvas.width !== STATE.w || canvas.height !== STATE.h) { canvas.width = STATE.w; canvas.height = STATE.h; }
            const w = STATE.w, h = STATE.h;
            ctx.clearRect(0, 0, w, h);

            // 1. Background
            if (STATE.layers.background) {
                ctx.fillStyle = STATE.c1;
                ctx.fillRect(0, 0, w, h);
            }

            // 2. Pattern
            if (STATE.layers.pattern) {
                ctx.save();
                ctx.globalAlpha = 1;
                if (STATE.pat === 'gradient') {
                    const angle = STATE.gradAngle * Math.PI / 180;
                    const x1 = w / 2 - Math.cos(angle) * w;
                    const y1 = h / 2 - Math.sin(angle) * h;
                    const x2 = w / 2 + Math.cos(angle) * w;
                    const y2 = h / 2 + Math.sin(angle) * h;
                    const g = ctx.createLinearGradient(x1, y1, x2, y2);
                    STATE.gradStops.forEach(s => g.addColorStop(s.pos / 100, s.col));
                    ctx.fillStyle = g;
                    ctx.fillRect(0, 0, w, h);
                }
                else if (STATE.pat === 'radial') {
                    const g = ctx.createRadialGradient(w / 2, h / 2, 0, w / 2, h / 2, Math.max(w, h) / 1.5);
                    g.addColorStop(0, STATE.c2);
                    g.addColorStop(1, STATE.c1);
                    ctx.fillStyle = g;
                    ctx.fillRect(0, 0, w, h);
                }
                else if (STATE.pat === 'blobs') {
                    STATE.blobs.forEach(b => { ctx.beginPath(); ctx.arc(b.x * w, b.y * h, b.r * Math.min(w, h), 0, Math.PI * 2); ctx.fillStyle = STATE.c2; ctx.globalAlpha = b.a; ctx.fill(); });
                }
                else if (STATE.pat === 'grid') { ctx.strokeStyle = STATE.c2; ctx.globalAlpha = 0.15; for (let x = 0; x <= w; x += 40) { ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, h); ctx.stroke(); } for (let y = 0; y <= h; y += 40) { ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(w, y); ctx.stroke(); } }
                else if (STATE.pat === 'dots') { ctx.fillStyle = STATE.c2; ctx.globalAlpha = 0.2; for (let x = 0; x < w; x += 30) for (let y = 0; y < h; y += 30) { ctx.beginPath(); ctx.arc(x, y, 2, 0, Math.PI * 2); ctx.fill(); } }
                else if (STATE.pat === 'stripes') { ctx.strokeStyle = STATE.c2; ctx.globalAlpha = 0.1; ctx.lineWidth = 40; for (let i = -h; i < w; i += 80) { ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i + h, h); ctx.stroke(); } }
                else if (STATE.pat === 'solid') { ctx.fillStyle = STATE.c1; ctx.fillRect(0, 0, w, h); }
                else if (STATE.pat === 'noise') { for (let i = 0; i < 600; i++) { ctx.fillStyle = Math.random() > 0.5 ? STATE.c2 : '#fff'; ctx.globalAlpha = 0.1; ctx.fillRect(Math.random() * w, Math.random() * h, 2, 2); } }
                else if (STATE.pat === 'waves') { ctx.strokeStyle = STATE.c2; ctx.globalAlpha = 0.3; ctx.lineWidth = 3; for (let y = 0; y < h; y += 60) { ctx.beginPath(); for (let x = 0; x <= w; x += 10) { ctx.lineTo(x, y + Math.sin((x + y) / 30) * 20); } ctx.stroke(); } }
                else if (STATE.pat === 'hexagons') { ctx.strokeStyle = STATE.c2; ctx.globalAlpha = 0.2; const s = 30; for (let y = 0; y < h + s; y += s * 1.5) for (let x = 0; x < w + s; x += s * 1.732) { ctx.beginPath(); const ox = (y / (s * 1.5)) % 2 === 0 ? 0 : s * 0.866; for (let i = 0; i < 6; i++) { const a = i * Math.PI / 3; ctx.lineTo(x + ox + s * Math.cos(a), y + s * Math.sin(a)); } ctx.closePath(); ctx.stroke(); } }
                else if (STATE.pat === 'zigzag') { ctx.strokeStyle = STATE.c2; ctx.globalAlpha = 0.25; const s = 40; for (let y = 0; y < h; y += s * 2) { ctx.beginPath(); for (let x = 0; x <= w; x += s) ctx.lineTo(x, y + ((x / s) % 2 === 0 ? 0 : s)); ctx.stroke(); } }
                else if (STATE.pat === 'chevron') { ctx.strokeStyle = STATE.c2; ctx.globalAlpha = 0.2; const s = 40; for (let y = 0; y < h; y += s) { ctx.beginPath(); for (let x = 0; x <= w; x += s) { ctx.moveTo(x, y); ctx.lineTo(x + s / 2, y + s / 2); ctx.lineTo(x + s, y); } ctx.stroke(); } }
                else if (STATE.pat === 'crosshatch') { ctx.strokeStyle = STATE.c2; ctx.globalAlpha = 0.15; for (let i = -h; i < w; i += 20) { ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i + h, h); ctx.stroke(); } for (let i = 0; i < w + h; i += 20) { ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i - h, h); ctx.stroke(); } }
                else if (STATE.pat === 'confetti') { ctx.globalAlpha = 0.3; for (let i = 0; i < 100; i++) { ctx.fillStyle = i % 2 ? STATE.c2 : STATE.c1; ctx.save(); ctx.translate(Math.random() * w, Math.random() * h); ctx.rotate(Math.random() * 6); ctx.fillRect(0, 0, Math.random() * 15 + 5, Math.random() * 10 + 2); ctx.restore(); } }
                else if (STATE.pat === 'circles') { ctx.globalAlpha = 0.15; ctx.fillStyle = STATE.c2; for (let i = 0; i < 40; i++) { ctx.beginPath(); ctx.arc(Math.random() * w, Math.random() * h, Math.random() * 40 + 10, 0, Math.PI * 2); ctx.fill(); } }
                else if (STATE.pat === 'diagonal') { ctx.strokeStyle = STATE.c2; ctx.globalAlpha = 0.2; for (let i = -h; i < w; i += 30) { ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i + h, h); ctx.stroke(); } }
                ctx.restore();
            }

            // 3. Background Image
            if (STATE.layers.bgImage && STATE.bgImage.img) {
                ctx.save();
                ctx.globalAlpha = STATE.bgImage.opacity / 100;
                const scale = STATE.bgImage.scale / 100;
                const iw = STATE.bgImage.img.width * scale;
                const ih = STATE.bgImage.img.height * scale;
                ctx.drawImage(STATE.bgImage.img, (w - iw) / 2, (h - ih) / 2, iw, ih);
                ctx.restore();
            }

            // 4. Shapes
            if (STATE.layers.shapes) {
                STATE.shapes.forEach((s, idx) => {
                    ctx.save();
                    ctx.translate(s.x / 100 * w, s.y / 100 * h);
                    ctx.rotate(s.rotation * Math.PI / 180);
                    if (s.blur) ctx.filter = `blur(${s.blur}px)`;
                    if (s.glow) { ctx.shadowColor = s.color; ctx.shadowBlur = s.glow; }
                    ctx.fillStyle = s.color;
                    ctx.beginPath();
                    drawShape(s.type, s.size);
                    ctx.fill();
                    ctx.restore();
                });
            }

            // 5. Icon
            if (STATE.layers.icon && STATE.icon.show) {
                ctx.save();
                ctx.font = `${STATE.icon.size}px "Apple Color Emoji", "Segoe UI Emoji"`;
                ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                ctx.shadowColor = 'rgba(0,0,0,0.3)'; ctx.shadowBlur = STATE.icon.shadow; ctx.shadowOffsetY = STATE.icon.shadow / 2;
                ctx.fillStyle = STATE.icon.color;
                ctx.fillText(STATE.icon.char, STATE.icon.x / 100 * w, STATE.icon.y / 100 * h);
                ctx.restore();
            }

            // 6. Text
            if (STATE.layers.text1) drawText(STATE.t1, true);
            if (STATE.layers.text2) drawText(STATE.t2, false);

            // 7. Watermark
            if (STATE.layers.watermark && STATE.watermark.enabled) {
                ctx.save();
                ctx.globalAlpha = STATE.watermark.opacity / 100;
                ctx.font = `${STATE.watermark.size}px Inter`;
                ctx.fillStyle = '#fff';
                const p = STATE.watermark.position;
                if (p === 'center') { ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; ctx.fillText(STATE.watermark.text, w / 2, h / 2); }
                else {
                    ctx.textAlign = p.includes('right') ? 'right' : 'left';
                    ctx.textBaseline = p.includes('bottom') ? 'bottom' : 'top';
                    const pad = 20;
                    const wx = p.includes('right') ? w - pad : pad;
                    const wy = p.includes('bottom') ? h - pad : pad;
                    ctx.fillText(STATE.watermark.text, wx, wy);
                }
                ctx.restore();
            }
        }

        function drawShape(type, size) {
            const s = size;
            if (type === 'circle') ctx.arc(0, 0, s / 2, 0, Math.PI * 2);
            else if (type === 'square') ctx.rect(-s / 2, -s / 2, s, s);
            else if (type === 'triangle') { ctx.moveTo(0, -s / 2); ctx.lineTo(s / 2, s / 2); ctx.lineTo(-s / 2, s / 2); ctx.closePath(); }
            else if (type === 'star') { for (let i = 0; i < 10; i++) { const r = i % 2 === 0 ? s / 2 : s / 4; ctx.lineTo(r * Math.cos(i * Math.PI / 5 - Math.PI / 2), r * Math.sin(i * Math.PI / 5 - Math.PI / 2)); } ctx.closePath(); }
            else if (type === 'hexagon') { for (let i = 0; i < 6; i++) { ctx.lineTo(s / 2 * Math.cos(i * Math.PI / 3), s / 2 * Math.sin(i * Math.PI / 3)); } ctx.closePath(); }
            else if (type === 'diamond') { ctx.moveTo(0, -s / 2); ctx.lineTo(s / 2, 0); ctx.lineTo(0, s / 2); ctx.lineTo(-s / 2, 0); ctx.closePath(); }
            else if (type === 'heart') { const x = 0, y = -s / 4; ctx.moveTo(x, y + s / 4); ctx.bezierCurveTo(x, y, x - s / 2, y, x - s / 2, y + s / 4); ctx.bezierCurveTo(x - s / 2, y + s / 2, x, y + s * 0.7, x, y + s * 0.9); ctx.bezierCurveTo(x, y + s * 0.7, x + s / 2, y + s / 2, x + s / 2, y + s / 4); ctx.bezierCurveTo(x + s / 2, y, x, y, x, y + s / 4); }
            else if (type === 'lightning') { ctx.moveTo(s * 0.1, -s / 2); ctx.lineTo(-s * 0.3, 0); ctx.lineTo(0, 0); ctx.lineTo(-s * 0.1, s / 2); ctx.lineTo(s * 0.3, 0); ctx.lineTo(0, 0); ctx.closePath(); }
            else if (type === 'cross') { const t = s / 4; ctx.rect(-t, -s / 2, t * 2, s); ctx.rect(-s / 2, -t, s, t * 2); }
            else if (type === 'ring') { ctx.arc(0, 0, s / 2, 0, Math.PI * 2); ctx.moveTo(s / 3, 0); ctx.arc(0, 0, s / 3, 0, Math.PI * 2, true); }
            else if (type === 'arrow') { ctx.moveTo(-s / 2, -s / 6); ctx.lineTo(0, -s / 6); ctx.lineTo(0, -s / 3); ctx.lineTo(s / 2, 0); ctx.lineTo(0, s / 3); ctx.lineTo(0, s / 6); ctx.lineTo(-s / 2, s / 6); ctx.closePath(); }
            else if (type === 'blob') { ctx.moveTo(s * 0.4, 0); ctx.bezierCurveTo(s * 0.4, s * 0.3, s * 0.2, s * 0.5, 0, s * 0.4); ctx.bezierCurveTo(-s * 0.3, s * 0.3, -s * 0.5, s * 0.1, -s * 0.4, 0); ctx.bezierCurveTo(-s * 0.5, -s * 0.2, -s * 0.2, -s * 0.5, 0, -s * 0.4); ctx.bezierCurveTo(s * 0.3, -s * 0.5, s * 0.5, -s * 0.2, s * 0.4, 0); }
        }

        function drawText(t, bold) {
            if (!t.text) return;
            const size = parseInt(t.size);
            const w = STATE.w, h = STATE.h;
            ctx.save();

            let xPos = t.x / 100 * w;
            if (t.align === 'left') xPos = 40;
            else if (t.align === 'right') xPos = w - 40;

            ctx.translate(xPos, t.y / 100 * h);
            if (t.rotation) ctx.rotate(t.rotation * Math.PI / 180);

            ctx.font = `${bold ? 'bold' : 'normal'} ${size}px "${STATE.font}"`;
            ctx.textAlign = t.align || 'center';
            ctx.textBaseline = 'middle';

            if (t.hl) {
                const m = ctx.measureText(t.text);
                ctx.fillStyle = t.col === '#ffffff' ? 'rgba(0,0,0,0.7)' : 'rgba(255,255,255,0.9)';
                const boxX = t.align === 'left' ? -10 : t.align === 'right' ? -m.width - 10 : -m.width / 2 - 10;
                ctx.fillRect(boxX, -size / 2, m.width + 20, size);
            }

            if (t.stroke) {
                ctx.strokeStyle = STATE.textEffects.strokeColor;
                ctx.lineWidth = STATE.textEffects.strokeWidth;
                ctx.strokeText(t.text, 0, 0);
            }

            ctx.shadowColor = t.hl ? 'transparent' : 'rgba(0,0,0,0.5)';
            ctx.shadowBlur = t.hl ? 0 : STATE.textShadow;
            ctx.shadowOffsetY = t.hl ? 0 : 2;
            ctx.fillStyle = t.col;
            ctx.fillText(t.text, 0, 0);
            ctx.restore();
        }

        // ============ ACTIONS ============
        function genBlobs() { STATE.blobs = []; for (let i = 0; i < 12; i++) STATE.blobs.push({ x: Math.random(), y: Math.random(), r: Math.random() * 0.4 + 0.1, a: Math.random() * 0.3 + 0.05 }); }

        function saveState() {
            const stateCopy = JSON.parse(JSON.stringify(STATE));
            stateCopy.bgImage = { img: null, opacity: STATE.bgImage.opacity, scale: STATE.bgImage.scale };
            HISTORY.states = HISTORY.states.slice(0, HISTORY.index + 1);
            HISTORY.states.push(stateCopy);
            HISTORY.index++;
            if (HISTORY.states.length > HISTORY.max) { HISTORY.states.shift(); HISTORY.index--; }
        }

        function undo() { if (HISTORY.index > 0) { HISTORY.index--; restore(HISTORY.states[HISTORY.index]); showToast('Undo'); } }
        function redo() { if (HISTORY.index < HISTORY.states.length - 1) { HISTORY.index++; restore(HISTORY.states[HISTORY.index]); showToast('Redo'); } }

        function restore(s) {
            const bgImg = STATE.bgImage.img;
            Object.assign(STATE, JSON.parse(JSON.stringify(s)));
            STATE.bgImage.img = bgImg;
            syncUI(); draw(); fit();
        }

        function resetToDefault() {
            if (confirm('Reset all settings to default?')) {
                const bgImg = STATE.bgImage.img;
                Object.assign(STATE, JSON.parse(JSON.stringify(DEFAULT_STATE)));
                STATE.bgImage.img = bgImg;
                genBlobs(); syncUI(); draw(); fit(); saveState();
                showToast('Reset to default');
            }
        }

        function remix() {
            const rand = arr => arr[Math.floor(Math.random() * arr.length)];
            const rCol = () => '#' + Math.floor(Math.random() * 16777215).toString(16).padStart(6, '0');
            const rNum = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

            STATE.c1 = rCol(); STATE.c2 = rCol();
            STATE.pat = rand(['blobs', 'gradient', 'radial', 'grid', 'dots', 'waves', 'hexagons', 'circles', 'confetti', 'stripes']);
            STATE.font = rand(['Inter', 'Montserrat', 'Bebas Neue', 'Lobster', 'Playfair Display', 'Abril Fatface']);
            STATE.icon.char = rand(['üìã', 'üî•', '‚ú®', '‚ù§Ô∏è', 'üöÄ', 'üí°', 'üéâ', '‚≠ê', 'üé®', 'üíé', '‚ö°', 'üåü', 'üéØ', 'üîÆ']);
            STATE.icon.color = rCol();
            STATE.icon.x = rNum(10, 90); STATE.icon.y = rNum(10, 90);
            STATE.icon.size = rNum(80, 250);
            STATE.t1.col = rCol(); STATE.t2.col = rCol();
            STATE.t1.size = rNum(60, 120); STATE.t2.size = rNum(25, 50);
            STATE.gradAngle = rNum(0, 360);

            genBlobs(); syncUI(); draw(); fit(); saveState();
            showToast('‚ú® Remixed!');
        }

        function loadTemplate(id) {
            const t = TEMPLATES[id];
            if (!t) return;
            STATE.w = t.w; STATE.h = t.h; STATE.c1 = t.c1; STATE.c2 = t.c2; STATE.pat = t.pat; STATE.font = t.font;
            if (t.icon) Object.assign(STATE.icon, { show: true, char: 'üìã', size: 150, x: 85, y: 15, color: '#ffffff', shadow: 20, ...t.icon });
            if (t.t1) Object.assign(STATE.t1, { text: 'FreeClipboard', size: 90, x: 50, y: 45, col: '#ffffff', hl: false, stroke: false, rotation: 0, align: 'center', ...t.t1 });
            if (t.t2) Object.assign(STATE.t2, { text: 'Design Made Simple', size: 40, x: 50, y: 65, col: '#94a3b8', hl: false, rotation: 0, align: 'center', ...t.t2 });
            genBlobs(); syncUI(); draw(); fit(); saveState();
            showToast('Template loaded');
        }

        function addShape(type) {
            STATE.shapes.push({ type, x: 50, y: 50, size: 100, color: STATE.c2, rotation: 0, blur: 0, glow: 0 });
            STATE.activeShapeIndex = STATE.shapes.length - 1;
            updateShapeControls();
            draw(); saveState();
            document.getElementById('shapeControls').classList.remove('hidden');
        }

        function clearShapes() { STATE.shapes = []; STATE.activeShapeIndex = -1; draw(); saveState(); document.getElementById('shapeControls').classList.add('hidden'); }

        function deleteActiveShape() {
            if (STATE.activeShapeIndex >= 0) {
                STATE.shapes.splice(STATE.activeShapeIndex, 1);
                STATE.activeShapeIndex = STATE.shapes.length - 1;
                if (STATE.shapes.length === 0) document.getElementById('shapeControls').classList.add('hidden');
                else updateShapeControls();
                draw(); saveState();
            }
        }

        function updateShapeControls() {
            if (STATE.activeShapeIndex < 0 || !STATE.shapes[STATE.activeShapeIndex]) return;
            const s = STATE.shapes[STATE.activeShapeIndex];
            document.getElementById('shapeIndex').textContent = `#${STATE.activeShapeIndex + 1}`;
            document.getElementById('shapeCol').value = s.color;
            document.getElementById('shapeSize').value = s.size;
            document.getElementById('shapeSizeVal').textContent = s.size;
            document.getElementById('shapeRot').value = s.rotation;
            document.getElementById('shapeX').value = s.x;
            document.getElementById('shapeY').value = s.y;
            document.getElementById('shapeBlur').value = s.blur || 0;
            document.getElementById('shapeGlow').value = s.glow || 0;
        }

        function setSize(w, h) {
            if (document.getElementById('lockRatio').checked && STATE.aspectRatio) {
                STATE.w = w; STATE.h = Math.round(w / STATE.aspectRatio);
            } else {
                STATE.w = w; STATE.h = h;
                STATE.aspectRatio = w / h;
            }
            updateVal('inpW', STATE.w); updateVal('inpH', STATE.h);
            document.getElementById('dimLabel').innerText = `${STATE.w}x${STATE.h}`;
            draw(); fit(); saveState();
        }

        function setTextAlign(textNum, align) {
            const t = textNum === 1 ? STATE.t1 : STATE.t2;
            t.align = align;
            ['left', 'center', 'right'].forEach(a => {
                const btn = document.getElementById(`align${textNum}-${a}`);
                if (a === align) { btn.classList.add('bg-slate-700', 'text-white'); btn.classList.remove('text-slate-400'); }
                else { btn.classList.remove('bg-slate-700', 'text-white'); btn.classList.add('text-slate-400'); }
            });
            draw(); saveState();
        }

        function duplicateLayer(layer) {
            if (layer === 'shapes' && STATE.shapes.length > 0) {
                const copies = STATE.shapes.map(s => ({ ...s, x: s.x + 5, y: s.y + 5 }));
                STATE.shapes.push(...copies);
            } else if (layer === 'icon') {
                addShape('circle');
                const s = STATE.shapes[STATE.shapes.length - 1];
                s.x = STATE.icon.x; s.y = STATE.icon.y; s.size = STATE.icon.size / 2; s.color = STATE.icon.color;
            }
            draw(); saveState();
            showToast('Layer duplicated');
        }

        // ============ COLOR PALETTE ============
        function generatePalette() {
            const palettes = [
                ['#0f172a', '#38bdf8', '#f472b6', '#a78bfa', '#34d399'],
                ['#1e1b4b', '#7c3aed', '#f472b6', '#fbbf24', '#10b981'],
                ['#18181b', '#ef4444', '#f97316', '#eab308', '#22c55e'],
                ['#0c4a6e', '#0ea5e9', '#06b6d4', '#14b8a6', '#10b981'],
                ['#4c1d95', '#7c3aed', '#a855f7', '#d946ef', '#ec4899'],
                ['#1f2937', '#374151', '#6b7280', '#9ca3af', '#d1d5db'],
                ['#7f1d1d', '#b91c1c', '#dc2626', '#f87171', '#fca5a5'],
                ['#14532d', '#166534', '#22c55e', '#4ade80', '#86efac']
            ];
            const palette = palettes[Math.floor(Math.random() * palettes.length)];
            const container = document.getElementById('paletteColors');
            container.innerHTML = palette.map(c => `<div class="recent-color" style="background:${c}" onclick="applyPaletteColor(this, 'c1')"></div>`).join('');
            showToast('New palette generated');
        }

        function applyPaletteColor(el, target) {
            const color = el.style.background;
            const hex = rgbToHex(color);
            if (target === 'c1') { STATE.c1 = hex; updateVal('c1', hex); updateVal('hex1', hex); }
            else { STATE.c2 = hex; updateVal('c2', hex); updateVal('hex2', hex); }
            addRecentColor(hex);
            draw(); saveState();
        }

        function rgbToHex(rgb) {
            if (rgb.startsWith('#')) return rgb;
            const match = rgb.match(/\d+/g);
            if (!match) return rgb;
            return '#' + match.slice(0, 3).map(x => parseInt(x).toString(16).padStart(2, '0')).join('');
        }

        function addRecentColor(hex) {
            STATE.recentColors = STATE.recentColors.filter(c => c !== hex);
            STATE.recentColors.unshift(hex);
            if (STATE.recentColors.length > 10) STATE.recentColors.pop();
            updateRecentColorsUI();
        }

        function updateRecentColorsUI() {
            const container = document.getElementById('recentColors');
            container.innerHTML = STATE.recentColors.map(c => `<div class="recent-color" style="background:${c}" onclick="applyPaletteColor(this, 'c1')"></div>`).join('');
        }

        // ============ GRADIENT BUILDER ============
        function updateGradientBuilder() {
            const show = STATE.pat === 'gradient';
            document.getElementById('gradientBuilder').classList.toggle('hidden', !show);
        }

        function addGradientStop() {
            const pos = STATE.gradStops.length > 0 ? Math.min(100, STATE.gradStops[STATE.gradStops.length - 1].pos + 25) : 50;
            STATE.gradStops.push({ pos, col: STATE.c2 });
            renderGradientStops();
            draw();
        }

        function renderGradientStops() {
            const container = document.getElementById('gradientStops');
            container.innerHTML = STATE.gradStops.map((s, i) => `
                <div class="flex gap-2 items-center">
                    <input type="color" value="${s.col}" onchange="STATE.gradStops[${i}].col=this.value;draw()" class="w-6 h-6 rounded bg-transparent border border-slate-600 p-0.5">
                    <input type="range" min="0" max="100" value="${s.pos}" onchange="STATE.gradStops[${i}].pos=parseInt(this.value);draw()" class="flex-1">
                    <span class="text-[9px] text-slate-400 w-8">${s.pos}%</span>
                    ${STATE.gradStops.length > 2 ? `<button onclick="STATE.gradStops.splice(${i},1);renderGradientStops();draw()" class="text-red-400 text-xs"><i class="ph ph-x"></i></button>` : ''}
                </div>
            `).join('');
        }

        // ============ PROJECT SAVE/LOAD ============
        function showProjectModal(mode) {
            document.getElementById('projectModal').classList.remove('hidden');
            document.getElementById('saveSection').classList.toggle('hidden', mode !== 'save');
            document.getElementById('loadSection').classList.toggle('hidden', mode !== 'load');
            document.getElementById('modalTitle').textContent = mode === 'save' ? 'Save Project' : 'Load Project';
        }

        function closeProjectModal() { document.getElementById('projectModal').classList.add('hidden'); }

        function saveProject() {
            const name = document.getElementById('projectName').value || 'project';
            const data = JSON.parse(JSON.stringify(STATE));
            data.bgImage = { img: null, opacity: STATE.bgImage.opacity, scale: STATE.bgImage.scale };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `${name}.json`;
            a.click();
            closeProjectModal();
            showToast('Project saved');
        }

        function loadProject() {
            const file = document.getElementById('loadFile').files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = e => {
                try {
                    const data = JSON.parse(e.target.result);
                    const bgImg = STATE.bgImage.img;
                    Object.assign(STATE, data);
                    STATE.bgImage.img = bgImg;
                    syncUI(); draw(); fit(); saveState();
                    closeProjectModal();
                    showToast('Project loaded');
                } catch (err) { showToast('Invalid project file'); }
            };
            reader.readAsText(file);
        }

        // ============ CLIPBOARD & DOWNLOAD ============
        async function copyToClipboard() {
            try {
                const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
                await navigator.clipboard.write([new ClipboardItem({ 'image/png': blob })]);
                showToast('Copied to clipboard!');
            } catch (err) {
                showToast('Copy failed - try download instead');
            }
        }

        function download() {
            const fmt = document.getElementById('fmt').value;
            const quality = fmt === 'jpeg' ? document.getElementById('jpegQuality').value / 100 : 1;
            const l = document.createElement('a');
            l.download = document.getElementById('fname').value + '.' + fmt;
            l.href = canvas.toDataURL(`image/${fmt}`, quality);
            l.click();
            showToast('Downloaded!');
        }

        // ============ FULLSCREEN ============
        function toggleFullscreen() {
            const modal = document.getElementById('fullscreenModal');
            const isHidden = modal.classList.contains('hidden');
            modal.classList.toggle('hidden');
            if (isHidden) {
                const fc = document.getElementById('fullscreenCanvas');
                fc.width = STATE.w; fc.height = STATE.h;
                const fctx = fc.getContext('2d');
                fctx.drawImage(canvas, 0, 0);
                const maxW = window.innerWidth * 0.9;
                const maxH = window.innerHeight * 0.9;
                const scale = Math.min(maxW / STATE.w, maxH / STATE.h);
                fc.style.width = STATE.w * scale + 'px';
                fc.style.height = STATE.h * scale + 'px';
            }
        }

        // ============ GUIDES ============
        function toggleGuides() {
            STATE.guides = !STATE.guides;
            document.getElementById('guides').classList.toggle('hidden', !STATE.guides);
            document.getElementById('guidesBtn').classList.toggle('bg-pink-500', STATE.guides);
        }

        // ============ COLLAPSIBLE SECTIONS ============
        function toggleSection(header) {
            const content = header.nextElementSibling;
            const icon = header.querySelector('.ph-caret-down');
            content.classList.toggle('collapsed');
            if (icon) icon.style.transform = content.classList.contains('collapsed') ? 'rotate(-90deg)' : '';
        }

        // ============ TOAST ============
        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.style.opacity = '1';
            setTimeout(() => toast.style.opacity = '0', 2000);
        }

        // ============ CLEAR BG IMAGE ============
        function clearBgImage() {
            STATE.bgImage.img = null;
            document.getElementById('bgImageControls').style.display = 'none';
            document.getElementById('bgUpload').value = '';
            draw(); saveState();
        }

        // ============ SYNC UI ============
        function syncUI() {
            updateVal('inpW', STATE.w); updateVal('inpH', STATE.h);
            updateVal('c1', STATE.c1); updateVal('hex1', STATE.c1);
            updateVal('c2', STATE.c2); updateVal('hex2', STATE.c2);
            updateVal('pattern', STATE.pat); updateVal('font', STATE.font);
            updateVal('showIcon', STATE.icon.show); updateVal('iconSelect', STATE.icon.char); updateVal('iconColor', STATE.icon.color);
            updateVal('iconSize', STATE.icon.size); updateVal('iconX', STATE.icon.x); updateVal('iconY', STATE.icon.y);
            updateVal('iconShadow', STATE.icon.shadow || 20);
            updateVal('t1', STATE.t1.text); updateVal('tc1', STATE.t1.col); updateVal('ts1', STATE.t1.size); updateVal('ty1', STATE.t1.y); updateVal('tx1', STATE.t1.x); updateVal('th1', STATE.t1.hl);
            updateVal('t2', STATE.t2.text); updateVal('tc2', STATE.t2.col); updateVal('ts2', STATE.t2.size); updateVal('ty2', STATE.t2.y); updateVal('tx2', STATE.t2.x); updateVal('th2', STATE.t2.hl);
            updateVal('textStroke1', STATE.t1.stroke); updateVal('strokeWidth', STATE.textEffects.strokeWidth); updateVal('strokeColor', STATE.textEffects.strokeColor);
            updateVal('textRotation1', STATE.t1.rotation); updateVal('textRotation2', STATE.t2.rotation);
            updateVal('textShadow', STATE.textShadow);
            updateVal('wmEnabled', STATE.watermark.enabled); updateVal('wmText', STATE.watermark.text); updateVal('wmPos', STATE.watermark.position); updateVal('wmOp', STATE.watermark.opacity); updateVal('wmSize', STATE.watermark.size);
            updateVal('gradAngle', STATE.gradAngle);
            document.getElementById('gradAngleVal').textContent = STATE.gradAngle + '¬∞';
            document.getElementById('dimLabel').innerText = `${STATE.w}x${STATE.h}`;
            updateGradientBuilder();
            renderGradientStops();
            updateRecentColorsUI();
            // Layer checkboxes
            updateVal('layer-bg', STATE.layers.background);
            updateVal('layer-bgimg', STATE.layers.bgImage);
            updateVal('layer-shapes', STATE.layers.shapes);
            updateVal('layer-icon', STATE.layers.icon);
            updateVal('layer-text1', STATE.layers.text1);
            updateVal('layer-text2', STATE.layers.text2);
            updateVal('layer-wm', STATE.layers.watermark);
            // Text alignment
            ['left', 'center', 'right'].forEach(a => {
                const btn1 = document.getElementById(`align1-${a}`);
                const btn2 = document.getElementById(`align2-${a}`);
                if (btn1) { btn1.classList.toggle('bg-slate-700', STATE.t1.align === a); btn1.classList.toggle('text-white', STATE.t1.align === a); }
                if (btn2) { btn2.classList.toggle('bg-slate-700', STATE.t2.align === a); btn2.classList.toggle('text-white', STATE.t2.align === a); }
            });
        }

        function updateVal(id, v) { const el = document.getElementById(id); if (el) el.type === 'checkbox' ? el.checked = v : el.value = v; }

        // ============ INPUT BINDINGS ============
        function bindInputs() {
            const on = (id, fn) => { const el = document.getElementById(id); if (el) el.addEventListener('input', fn); };
            const onChange = (id, fn) => { const el = document.getElementById(id); if (el) el.addEventListener('change', fn); };

            on('inpW', e => {
                const newW = parseInt(e.target.value);
                if (document.getElementById('lockRatio').checked && STATE.aspectRatio) {
                    STATE.w = newW; STATE.h = Math.round(newW / STATE.aspectRatio);
                    updateVal('inpH', STATE.h);
                } else { STATE.w = newW; STATE.aspectRatio = STATE.w / STATE.h; }
                document.getElementById('dimLabel').innerText = `${STATE.w}x${STATE.h}`;
                draw(); fit();
            });
            on('inpH', e => {
                const newH = parseInt(e.target.value);
                if (document.getElementById('lockRatio').checked && STATE.aspectRatio) {
                    STATE.h = newH; STATE.w = Math.round(newH * STATE.aspectRatio);
                    updateVal('inpW', STATE.w);
                } else { STATE.h = newH; STATE.aspectRatio = STATE.w / STATE.h; }
                document.getElementById('dimLabel').innerText = `${STATE.w}x${STATE.h}`;
                draw(); fit();
            });

            on('c1', e => { STATE.c1 = e.target.value; updateVal('hex1', STATE.c1); addRecentColor(STATE.c1); draw(); });
            on('c2', e => { STATE.c2 = e.target.value; updateVal('hex2', STATE.c2); addRecentColor(STATE.c2); draw(); });
            on('hex1', e => { if (/^#[0-9A-Fa-f]{6}$/.test(e.target.value)) { STATE.c1 = e.target.value; updateVal('c1', STATE.c1); draw(); } });
            on('hex2', e => { if (/^#[0-9A-Fa-f]{6}$/.test(e.target.value)) { STATE.c2 = e.target.value; updateVal('c2', STATE.c2); draw(); } });
            on('pattern', e => { STATE.pat = e.target.value; if (STATE.pat === 'blobs') genBlobs(); updateGradientBuilder(); draw(); });
            on('gradAngle', e => { STATE.gradAngle = parseInt(e.target.value); document.getElementById('gradAngleVal').textContent = STATE.gradAngle + '¬∞'; draw(); });

            // Icon
            onChange('showIcon', e => { STATE.icon.show = e.target.checked; draw(); });
            on('iconSelect', e => { STATE.icon.char = e.target.value; draw(); });
            on('iconColor', e => { STATE.icon.color = e.target.value; draw(); });
            on('iconSize', e => { STATE.icon.size = parseInt(e.target.value); draw(); });
            on('iconX', e => { STATE.icon.x = parseInt(e.target.value); draw(); });
            on('iconY', e => { STATE.icon.y = parseInt(e.target.value); draw(); });
            on('iconShadow', e => { STATE.icon.shadow = parseInt(e.target.value); draw(); });

            // Shapes
            on('shapeCol', e => { if (STATE.activeShapeIndex >= 0) { STATE.shapes[STATE.activeShapeIndex].color = e.target.value; draw(); } });
            on('shapeSize', e => { if (STATE.activeShapeIndex >= 0) { STATE.shapes[STATE.activeShapeIndex].size = parseInt(e.target.value); document.getElementById('shapeSizeVal').textContent = e.target.value; draw(); } });
            on('shapeRot', e => { if (STATE.activeShapeIndex >= 0) { STATE.shapes[STATE.activeShapeIndex].rotation = parseInt(e.target.value); draw(); } });
            on('shapeX', e => { if (STATE.activeShapeIndex >= 0) { STATE.shapes[STATE.activeShapeIndex].x = parseInt(e.target.value); draw(); } });
            on('shapeY', e => { if (STATE.activeShapeIndex >= 0) { STATE.shapes[STATE.activeShapeIndex].y = parseInt(e.target.value); draw(); } });
            on('shapeBlur', e => { if (STATE.activeShapeIndex >= 0) { STATE.shapes[STATE.activeShapeIndex].blur = parseInt(e.target.value); draw(); } });
            on('shapeGlow', e => { if (STATE.activeShapeIndex >= 0) { STATE.shapes[STATE.activeShapeIndex].glow = parseInt(e.target.value); draw(); } });

            // Image Upload
            document.getElementById('bgUpload').addEventListener('change', function (e) {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = function (evt) {
                    const img = new Image();
                    img.onload = function () {
                        STATE.bgImage.img = img;
                        document.getElementById('bgImageControls').style.display = 'block';
                        draw(); saveState();
                    };
                    img.src = evt.target.result;
                };
                reader.readAsDataURL(file);
            });
            on('bgImgOp', e => { STATE.bgImage.opacity = parseInt(e.target.value); draw(); });
            on('bgImgScale', e => { STATE.bgImage.scale = parseInt(e.target.value); draw(); });

            // Text
            on('font', e => { STATE.font = e.target.value; draw(); });
            on('t1', e => { STATE.t1.text = e.target.value; draw(); });
            on('tc1', e => { STATE.t1.col = e.target.value; draw(); });
            on('ts1', e => { STATE.t1.size = parseInt(e.target.value); draw(); });
            on('th1', e => { STATE.t1.hl = e.target.checked; draw(); });
            on('ty1', e => { STATE.t1.y = parseInt(e.target.value); draw(); });
            on('tx1', e => { STATE.t1.x = parseInt(e.target.value); draw(); });
            on('t2', e => { STATE.t2.text = e.target.value; draw(); });
            on('tc2', e => { STATE.t2.col = e.target.value; draw(); });
            on('ts2', e => { STATE.t2.size = parseInt(e.target.value); draw(); });
            on('th2', e => { STATE.t2.hl = e.target.checked; draw(); });
            on('ty2', e => { STATE.t2.y = parseInt(e.target.value); draw(); });
            on('tx2', e => { STATE.t2.x = parseInt(e.target.value); draw(); });
            on('textStroke1', e => { STATE.t1.stroke = e.target.checked; draw(); });
            on('strokeWidth', e => { STATE.textEffects.strokeWidth = parseInt(e.target.value); draw(); });
            on('strokeColor', e => { STATE.textEffects.strokeColor = e.target.value; draw(); });
            on('textRotation1', e => { STATE.t1.rotation = parseInt(e.target.value); draw(); });
            on('textRotation2', e => { STATE.t2.rotation = parseInt(e.target.value); draw(); });
            on('textShadow', e => { STATE.textShadow = parseInt(e.target.value); draw(); });

            // Watermark
            onChange('wmEnabled', e => { STATE.watermark.enabled = e.target.checked; draw(); });
            on('wmText', e => { STATE.watermark.text = e.target.value; draw(); });
            on('wmPos', e => { STATE.watermark.position = e.target.value; draw(); });
            on('wmOp', e => { STATE.watermark.opacity = parseInt(e.target.value); draw(); });
            on('wmSize', e => { STATE.watermark.size = parseInt(e.target.value); draw(); });

            // Format quality
            onChange('fmt', e => {
                document.getElementById('jpegQualityWrap').classList.toggle('hidden', e.target.value !== 'jpeg');
            });
            on('jpegQuality', e => { document.getElementById('qualityVal').textContent = e.target.value + '%'; });

            // Save state on change
            document.querySelectorAll('input[type=range]').forEach(el => el.addEventListener('change', saveState));
            document.querySelectorAll('input[type=checkbox], select, input[type=color]').forEach(el => el.addEventListener('change', saveState));
        }

        // ============ KEYBOARD SHORTCUTS ============
        function bindKeyboard() {
            document.addEventListener('keydown', e => {
                // Ignore if typing in input
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') return;

                if (e.ctrlKey || e.metaKey) {
                    if (e.key === 'z') { e.preventDefault(); undo(); }
                    else if (e.key === 'y') { e.preventDefault(); redo(); }
                    else if (e.key === 's') { e.preventDefault(); download(); }
                    else if (e.key === 'c') { e.preventDefault(); copyToClipboard(); }
                } else {
                    if (e.key === 'r' || e.key === 'R') { e.preventDefault(); remix(); }
                    else if (e.key === 'g' || e.key === 'G') { e.preventDefault(); toggleGuides(); }
                    else if (e.key === 'f' || e.key === 'F') { e.preventDefault(); toggleFullscreen(); }
                    else if (e.key === 'Escape') {
                        document.getElementById('fullscreenModal').classList.add('hidden');
                        closeProjectModal();
                    }
                }
            });
        }

        // ============ VIEW & FIT ============
        window.fit = () => {
            const st = document.getElementById('stage');
            const pad = 60;
            const sc = Math.min((st.clientWidth - pad) / STATE.w, (st.clientHeight - pad) / STATE.h) * (STATE.view !== 'raw' ? 0.85 : 1);
            wrapper.style.transform = `scale(${sc})`;
            wrapper.style.width = STATE.view !== 'raw' ? STATE.w + 'px' : 'auto';
            wrapper.style.height = STATE.view !== 'raw' ? STATE.h + 'px' : 'auto';
        };

        window.setView = m => {
            STATE.view = m;
            ['raw', 'phone', 'laptop'].forEach(v => {
                const btn = document.getElementById('v-' + v);
                btn.className = v === m
                    ? "px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider bg-white text-slate-900 transition"
                    : "px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider text-slate-500 hover:text-white transition";
            });
            wrapper.className = "relative shadow-2xl origin-center transition-all " + (m === 'phone' ? 'device-phone' : m === 'laptop' ? 'device-laptop' : '');
            fit();
        };

        window.toggleLayer = l => {
            STATE.layers[l] = !STATE.layers[l];
            draw();
        };

        // ============ TOUCH GESTURES ============
        let touchStartDist = 0;
        let touchStartScale = 1;

        document.getElementById('stage').addEventListener('touchstart', e => {
            if (e.touches.length === 2) {
                touchStartDist = Math.hypot(e.touches[0].clientX - e.touches[1].clientX, e.touches[0].clientY - e.touches[1].clientY);
                touchStartScale = parseFloat(wrapper.style.transform.replace('scale(', '').replace(')', '')) || 1;
            }
        }, { passive: true });

        document.getElementById('stage').addEventListener('touchmove', e => {
            if (e.touches.length === 2) {
                const dist = Math.hypot(e.touches[0].clientX - e.touches[1].clientX, e.touches[0].clientY - e.touches[1].clientY);
                const scale = Math.max(0.1, Math.min(3, touchStartScale * (dist / touchStartDist)));
                wrapper.style.transform = `scale(${scale})`;
            }
        }, { passive: true });

        // ============ INIT ============
        init();
    </script>
</body>

</html>