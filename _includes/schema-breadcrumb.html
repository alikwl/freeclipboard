{% comment %}
Enhanced BreadcrumbList Schema with proper hierarchy
Usage: {% include schema-breadcrumb.html %}
{% endcomment %}

{% assign breadcrumb_items = "" | split: "" %}

{% comment %} Always start with Home {% endcomment %}
{% assign home_item = '{"position":1,"name":"Home","item":"' | append: site.url | append: '/"}' %}
{% assign breadcrumb_items = breadcrumb_items | push: home_item %}

{% comment %} Determine page type and build breadcrumb {% endcomment %}
{% if page.url contains '/tools/' %}
  {% comment %} Tool page - add category then tool {% endcomment %}
  {% assign cat_name = page.category_name | default: "Tools" %}
  {% assign cat_url = page.category_url | default: "/all-tools/" %}
  {% assign cat_item = '{"position":2,"name":"' | append: cat_name | append: '","item":"' | append: site.url | append: cat_url | append: '"}' %}
  {% assign breadcrumb_items = breadcrumb_items | push: cat_item %}
  
  {% assign tool_name = page.title | split: ' - ' | first | split: ' | ' | first %}
  {% assign tool_item = '{"position":3,"name":"' | append: tool_name | append: '","item":"' | append: site.url | append: page.url | replace: 'index.html', '' | append: '"}' %}
  {% assign breadcrumb_items = breadcrumb_items | push: tool_item %}

{% elsif page.url contains '/blog/' or page.layout == 'post' %}
  {% comment %} Blog post {% endcomment %}
  {% assign blog_item = '{"position":2,"name":"Blog","item":"' | append: site.url | append: '/blog/"}' %}
  {% assign breadcrumb_items = breadcrumb_items | push: blog_item %}
  
  {% if page.title %}
    {% assign post_title = page.title | replace: '"', '\"' %}
    {% assign post_item = '{"position":3,"name":"' | append: post_title | append: '","item":"' | append: site.url | append: page.url | append: '"}' %}
    {% assign breadcrumb_items = breadcrumb_items | push: post_item %}
  {% endif %}

{% elsif page.url contains '/free-resources/' %}
  {% comment %} Free resources page {% endcomment %}
  {% assign resources_item = '{"position":2,"name":"Free Resources","item":"' | append: site.url | append: '/free-resources/"}' %}
  {% assign breadcrumb_items = breadcrumb_items | push: resources_item %}
  
  {% if page.url != '/free-resources/' and page.title %}
    {% assign resource_title = page.title | replace: '"', '\"' %}
    {% assign resource_item = '{"position":3,"name":"' | append: resource_title | append: '","item":"' | append: site.url | append: page.url | append: '"}' %}
    {% assign breadcrumb_items = breadcrumb_items | push: resource_item %}
  {% endif %}

{% elsif page.url != '/' and page.title %}
  {% comment %} Other pages {% endcomment %}
  {% assign page_title = page.title | split: ' - ' | first | replace: '"', '\"' %}
  {% assign page_item = '{"position":2,"name":"' | append: page_title | append: '","item":"' | append: site.url | append: page.url | replace: 'index.html', '' | append: '"}' %}
  {% assign breadcrumb_items = breadcrumb_items | push: page_item %}
{% endif %}

{% if breadcrumb_items.size > 1 %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {% for item in breadcrumb_items %}
    {
      "@type": "ListItem",
      {{ item }}
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ]
}
</script>
{% endif %}
