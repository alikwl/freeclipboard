<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FreeClipboard Studio | Image Creator</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=Lobster&family=Montserrat:wght@400;700;900&family=Playfair+Display:ital,wght@0,700;1,400&family=Roboto+Mono:wght@400;700&family=Abril+Fatface&family=Bebas+Neue&display=swap" rel="stylesheet">
    
    <style>
        /* Base & UI */
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; }
        
        /* Custom Scrollbar */
        .custom-scroll::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: #1e293b; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #64748b; }
        
        /* Canvas Transparency Pattern */
        .check-pattern {
            background-color: #1e293b;
            background-image: 
                linear-gradient(45deg, #0f172a 25%, transparent 25%), 
                linear-gradient(-45deg, #0f172a 25%, transparent 25%), 
                linear-gradient(45deg, transparent 75%, #0f172a 75%), 
                linear-gradient(-45deg, transparent 75%, #0f172a 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }

        /* Ranges */
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 14px; width: 14px;
            border-radius: 50%; background: #38bdf8; margin-top: -5px;
            box-shadow: 0 0 0 2px #0f172a; cursor: grab;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px; background: #334155; border-radius: 2px;
        }

        /* Device Mockup Transitions */
        #mockupWrapper { transition: all 0.5s cubic-bezier(0.25, 0.8, 0.25, 1); }
        .device-phone {
            border: 14px solid #1e293b; border-radius: 40px; background: #000;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.6);
        }
        .device-phone::before { /* Notch */
            content: ''; position: absolute; top: 0; left: 50%; transform: translateX(-50%);
            width: 35%; height: 24px; background: #1e293b; 
            border-bottom-left-radius: 12px; border-bottom-right-radius: 12px; z-index: 10;
        }
        .device-laptop {
            border: 12px solid #1e293b; border-bottom-width: 24px;
            border-radius: 12px 12px 0 0; background: #000;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.6);
        }

        /* Animations */
        @keyframes pop {
            0% { transform: scale(0.95); opacity: 0.8; }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pop { animation: pop 0.3s ease-out; }
    </style>
</head>
<body class="text-slate-200 h-screen flex flex-col md:flex-row overflow-hidden">

    <!-- LEFT SIDEBAR: STUDIO CONTROLS -->
    <div class="w-full md:w-[400px] bg-slate-900 border-r border-slate-800 flex flex-col z-20 flex-shrink-0 h-[50vh] md:h-full shadow-2xl relative">
        
        <!-- Header -->
        <div class="p-4 border-b border-slate-800 bg-slate-900 sticky top-0 z-30 flex items-center justify-between">
            <div class="flex items-center gap-2.5">
                <div class="w-9 h-9 rounded-lg bg-sky-500 flex items-center justify-center text-white shadow-lg shadow-sky-500/20">
                    <i class="ph-bold ph-clipboard-text text-xl"></i>
                </div>
                <div>
                    <h1 class="font-bold text-base leading-tight text-white tracking-tight">FreeClipboard</h1>
                    <div class="text-[10px] text-sky-400 font-mono tracking-widest uppercase">Studio Editor</div>
                </div>
            </div>
            <!-- Magic Button -->
            <button onclick="remix()" class="group relative px-3 py-1.5 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 text-white text-xs font-bold shadow-lg shadow-purple-500/20 hover:scale-105 transition-all overflow-hidden">
                <div class="absolute inset-0 bg-white/20 group-hover:translate-x-full transition-transform duration-500 skew-x-12 -ml-4"></div>
                <div class="flex items-center gap-1">
                    <i class="ph-bold ph-magic-wand"></i> Remix
                </div>
            </button>
        </div>

        <!-- Controls Scroll Area -->
        <div class="flex-1 overflow-y-auto custom-scroll p-5 space-y-6">

            <!-- 1. Quick Presets (Vibes) -->
            <section>
                <h2 class="section-title text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-3">Quick Vibes</h2>
                <div class="grid grid-cols-4 gap-2">
                    <button onclick="applyTheme('corporate')" class="p-2 bg-slate-800 hover:bg-slate-700 rounded border border-slate-700 hover:border-sky-500/50 transition flex flex-col items-center gap-1 group">
                        <div class="w-4 h-4 rounded-full bg-blue-600 border border-slate-600"></div>
                        <span class="text-[9px] text-slate-400 group-hover:text-white">Pro</span>
                    </button>
                    <button onclick="applyTheme('sunset')" class="p-2 bg-slate-800 hover:bg-slate-700 rounded border border-slate-700 hover:border-orange-500/50 transition flex flex-col items-center gap-1 group">
                        <div class="w-4 h-4 rounded-full bg-gradient-to-br from-orange-400 to-purple-600 border border-slate-600"></div>
                        <span class="text-[9px] text-slate-400 group-hover:text-white">Sunset</span>
                    </button>
                    <button onclick="applyTheme('neon')" class="p-2 bg-slate-800 hover:bg-slate-700 rounded border border-slate-700 hover:border-lime-500/50 transition flex flex-col items-center gap-1 group">
                        <div class="w-4 h-4 rounded-full bg-lime-400 border border-slate-600"></div>
                        <span class="text-[9px] text-slate-400 group-hover:text-white">Neon</span>
                    </button>
                    <button onclick="applyTheme('dark')" class="p-2 bg-slate-800 hover:bg-slate-700 rounded border border-slate-700 hover:border-white/50 transition flex flex-col items-center gap-1 group">
                        <div class="w-4 h-4 rounded-full bg-slate-900 border border-slate-500"></div>
                        <span class="text-[9px] text-slate-400 group-hover:text-white">Dark</span>
                    </button>
                </div>
            </section>

            <!-- 2. Canvas Dimensions -->
            <section class="space-y-3 pt-2 border-t border-slate-800/50">
                <div class="flex items-center justify-between">
                    <h2 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Canvas</h2>
                    <span id="dimLabel" class="text-[9px] font-mono text-sky-400 bg-sky-900/20 px-1.5 py-0.5 rounded">1200x630</span>
                </div>
                <!-- Size Presets -->
                <div class="grid grid-cols-3 gap-2 mb-2">
                    <button onclick="setSize(1080,1080)" class="px-2 py-1.5 bg-slate-800 rounded text-[10px] text-slate-300 hover:bg-slate-700 border border-slate-700">Square</button>
                    <button onclick="setSize(1080,1920)" class="px-2 py-1.5 bg-slate-800 rounded text-[10px] text-slate-300 hover:bg-slate-700 border border-slate-700">Story</button>
                    <button onclick="setSize(1200,630)" class="px-2 py-1.5 bg-slate-800 rounded text-[10px] text-slate-300 hover:bg-slate-700 border border-slate-700">Link/OG</button>
                </div>
                <!-- Manual Inputs -->
                <div class="grid grid-cols-2 gap-2">
                    <div class="relative">
                        <i class="ph ph-arrows-out-line-horizontal absolute left-2 top-2 text-slate-500 text-xs"></i>
                        <input id="inpW" type="number" value="1200" class="w-full bg-slate-900 border border-slate-700 rounded py-1.5 pl-7 pr-2 text-xs text-white focus:border-sky-500 focus:outline-none placeholder-slate-600">
                    </div>
                    <div class="relative">
                        <i class="ph ph-arrows-out-line-vertical absolute left-2 top-2 text-slate-500 text-xs"></i>
                        <input id="inpH" type="number" value="630" class="w-full bg-slate-900 border border-slate-700 rounded py-1.5 pl-7 pr-2 text-xs text-white focus:border-sky-500 focus:outline-none placeholder-slate-600">
                    </div>
                </div>
            </section>

            <!-- 3. Background Design -->
            <section class="space-y-4 pt-2 border-t border-slate-800/50">
                <h2 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Background</h2>
                
                <!-- Color Pickers -->
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="text-[9px] text-slate-500 mb-1 block">Primary</label>
                        <div class="flex gap-2">
                            <input type="color" id="c1" value="#0f172a" class="w-8 h-8 rounded bg-transparent cursor-pointer border border-slate-600 p-0.5">
                            <input type="text" id="hex1" value="#0f172a" class="flex-1 bg-slate-800 border border-slate-700 rounded px-2 text-[10px] font-mono uppercase text-slate-300">
                        </div>
                    </div>
                    <div>
                        <label class="text-[9px] text-slate-500 mb-1 block">Secondary/Accent</label>
                        <div class="flex gap-2">
                            <input type="color" id="c2" value="#38bdf8" class="w-8 h-8 rounded bg-transparent cursor-pointer border border-slate-600 p-0.5">
                            <input type="text" id="hex2" value="#38bdf8" class="flex-1 bg-slate-800 border border-slate-700 rounded px-2 text-[10px] font-mono uppercase text-slate-300">
                        </div>
                    </div>
                </div>

                <!-- Pattern Selection -->
                <div>
                    <label class="text-[9px] text-slate-500 mb-1.5 block">Pattern Overlay</label>
                    <select id="pattern" class="w-full bg-slate-800 border border-slate-700 rounded px-2 py-2 text-xs text-white focus:border-sky-500 focus:outline-none">
                        <option value="blobs">Abstract Blobs (Trending)</option>
                        <option value="gradient">Linear Gradient</option>
                        <option value="grid">Technical Grid</option>
                        <option value="dots">Polka Dots</option>
                        <option value="stripes">Modern Stripes</option>
                        <option value="solid">Solid / Clean</option>
                        <option value="noise">Film Noise</option>
                    </select>
                </div>
            </section>

            <!-- 4. Icon Layer -->
            <section class="space-y-4 pt-2 border-t border-slate-800/50">
                <div class="flex items-center justify-between">
                    <h2 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest flex items-center gap-1">
                        <i class="ph-fill ph-sticker text-pink-400"></i> Icon Layer
                    </h2>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="showIcon" class="sr-only peer" checked>
                        <div class="w-7 h-4 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-3 after:w-3 after:transition-all peer-checked:bg-pink-500"></div>
                    </label>
                </div>
                
                <div id="iconControls" class="space-y-3 transition-opacity duration-200">
                    <div class="grid grid-cols-[1fr_auto] gap-2">
                        <select id="iconSelect" class="bg-slate-800 border border-slate-700 rounded px-2 py-1.5 text-lg text-white">
                            <option value="üìã">üìã Clipboard</option>
                            <option value="üî•">üî• Fire</option>
                            <option value="‚ú®">‚ú® Sparkles</option>
                            <option value="‚ù§Ô∏è">‚ù§Ô∏è Heart</option>
                            <option value="‚úÖ">‚úÖ Check</option>
                            <option value="üöÄ">üöÄ Rocket</option>
                            <option value="üí°">üí° Idea</option>
                            <option value="üîî">üîî Bell</option>
                            <option value="‚úÇÔ∏è">‚úÇÔ∏è Cut</option>
                            <option value="‚≠ê">‚≠ê Star</option>
                            <option value="üíª">üíª Laptop</option>
                            <option value="üéâ">üéâ Party</option>
                        </select>
                        <input type="color" id="iconColor" value="#ffffff" class="w-10 h-full rounded border border-slate-700 bg-transparent p-0.5 cursor-pointer">
                    </div>
                    
                    <div class="flex items-center gap-2">
                        <span class="text-[9px] text-slate-500 w-4">Sz</span>
                        <input type="range" id="iconSize" min="20" max="400" value="150" class="flex-1">
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="text-[9px] text-slate-500 w-4">X</span>
                        <input type="range" id="iconX" min="0" max="100" value="85" class="flex-1">
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="text-[9px] text-slate-500 w-4">Y</span>
                        <input type="range" id="iconY" min="0" max="100" value="15" class="flex-1">
                    </div>
                </div>
            </section>

            <!-- 5. Typography -->
            <section class="space-y-4 pt-2 border-t border-slate-800/50">
                <div class="flex items-center justify-between">
                    <h2 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Typography</h2>
                    <select id="font" class="bg-slate-800 border border-slate-700 rounded px-2 py-1 text-[10px] text-white w-24">
                        <option value="Inter">Inter</option>
                        <option value="Montserrat">Montserrat</option>
                        <option value="Abril Fatface">Abril (Bold)</option>
                        <option value="Bebas Neue">Bebas (Tall)</option>
                        <option value="Playfair Display">Playfair</option>
                        <option value="Lobster">Lobster</option>
                        <option value="Roboto Mono">Mono</option>
                    </select>
                </div>

                <!-- Text 1 -->
                <div class="bg-slate-800/50 p-3 rounded-lg border border-slate-800 group focus-within:border-sky-500 transition-colors">
                    <input type="text" id="t1" value="FreeClipboard" class="w-full bg-transparent border-b border-slate-700 pb-1 mb-2 text-sm font-bold text-white focus:outline-none focus:border-sky-500 transition-colors">
                    <div class="flex items-center gap-2 mb-2">
                        <input type="color" id="tc1" value="#ffffff" class="w-5 h-5 rounded border-none p-0 bg-transparent">
                        <input type="range" id="ts1" min="20" max="200" value="90" class="flex-1">
                        <label class="flex items-center gap-1 cursor-pointer">
                            <input type="checkbox" id="th1" class="rounded border-slate-600 bg-slate-700 text-sky-500 focus:ring-0 w-3 h-3">
                            <span class="text-[9px] text-slate-400">Box</span>
                        </label>
                    </div>
                    <input type="range" id="ty1" min="0" max="100" value="45" class="w-full h-1 bg-slate-700 rounded-lg">
                </div>

                <!-- Text 2 -->
                <div class="bg-slate-800/50 p-3 rounded-lg border border-slate-800 group focus-within:border-sky-500 transition-colors">
                    <input type="text" id="t2" value="Design Made Simple" class="w-full bg-transparent border-b border-slate-700 pb-1 mb-2 text-xs text-slate-300 focus:outline-none focus:border-sky-500 transition-colors">
                    <div class="flex items-center gap-2 mb-2">
                        <input type="color" id="tc2" value="#94a3b8" class="w-5 h-5 rounded border-none p-0 bg-transparent">
                        <input type="range" id="ts2" min="10" max="100" value="40" class="flex-1">
                        <label class="flex items-center gap-1 cursor-pointer">
                            <input type="checkbox" id="th2" class="rounded border-slate-600 bg-slate-700 text-sky-500 focus:ring-0 w-3 h-3">
                            <span class="text-[9px] text-slate-400">Box</span>
                        </label>
                    </div>
                    <input type="range" id="ty2" min="0" max="100" value="65" class="w-full h-1 bg-slate-700 rounded-lg">
                </div>
            </section>
            
            <div class="h-10"></div>
        </div>

        <!-- Footer: Export -->
        <div class="p-4 bg-slate-900 border-t border-slate-800">
            <div class="flex gap-2">
                <input type="text" id="fname" value="freeclipboard-design" class="bg-slate-800 border border-slate-700 rounded px-3 text-xs w-1/3 focus:outline-none text-slate-400 focus:text-white text-right">
                <select id="fmt" class="bg-slate-800 border border-slate-700 rounded px-2 text-xs text-slate-300 focus:outline-none">
                    <option value="png">PNG</option>
                    <option value="jpeg">JPG</option>
                    <option value="webp">WEBP</option>
                </select>
                <button onclick="download()" class="flex-1 bg-sky-600 hover:bg-sky-500 text-white font-bold py-2.5 rounded shadow-lg shadow-sky-600/20 transition-all flex items-center justify-center gap-2 text-sm">
                    <i class="ph-bold ph-download-simple"></i> Download
                </button>
            </div>
        </div>
    </div>

    <!-- RIGHT: PREVIEW AREA -->
    <div class="flex-1 bg-[#0b0f19] relative flex flex-col h-[50vh] md:h-full overflow-hidden">
        
        <!-- View Toolbar -->
        <div class="h-12 border-b border-slate-800 bg-slate-900/80 backdrop-blur flex items-center justify-center gap-2 px-4 z-30">
            <button onclick="setView('raw')" id="v-raw" class="px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider bg-white text-slate-900 transition">Raw</button>
            <button onclick="setView('phone')" id="v-phone" class="px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider text-slate-500 hover:text-white transition">Phone</button>
            <button onclick="setView('laptop')" id="v-laptop" class="px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider text-slate-500 hover:text-white transition">Laptop</button>
        </div>

        <!-- Canvas Stage -->
        <div class="flex-1 relative overflow-hidden check-pattern flex items-center justify-center p-8 md:p-16" id="stage">
            <div id="mockupWrapper" class="relative shadow-2xl origin-center">
                <canvas id="canvas" class="block"></canvas>
            </div>
        </div>

        <!-- Branding Watermark -->
        <div class="absolute bottom-4 left-4 text-[10px] text-slate-600 font-mono select-none">
            Powered by FreeClipboard.com
        </div>
    </div>

    <script>
        // --- DATA & CONFIG ---
        const THEMES = {
            corporate: { c1: '#0f172a', c2: '#3b82f6', pat: 'grid', font: 'Inter', t1c: '#ffffff', t2c: '#94a3b8' },
            sunset: { c1: '#4c1d95', c2: '#f59e0b', pat: 'blobs', font: 'Abril Fatface', t1c: '#ffffff', t2c: '#fbbf24' },
            neon: { c1: '#171717', c2: '#84cc16', pat: 'stripes', font: 'Bebas Neue', t1c: '#ffffff', t2c: '#a3e635' },
            dark: { c1: '#000000', c2: '#333333', pat: 'solid', font: 'Montserrat', t1c: '#ffffff', t2c: '#888888' },
        };

        const STATE = {
            w: 1200, h: 630,
            c1: '#0f172a', c2: '#38bdf8',
            pat: 'blobs',
            icon: { show: true, char: 'üìã', size: 150, x: 85, y: 15, color: '#ffffff' },
            font: 'Inter',
            t1: { text: 'FreeClipboard', size: 90, x: 50, y: 45, col: '#ffffff', hl: false },
            t2: { text: 'Design Made Simple', size: 40, x: 50, y: 65, col: '#94a3b8', hl: false },
            blobs: [], 
            view: 'raw'
        };

        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const wrapper = document.getElementById('mockupWrapper');

        // --- INIT ---
        function init() {
            genBlobs();
            bindInputs();
            draw();
            fit();
            window.addEventListener('resize', fit);
        }

        // --- DRAWING ENGINE ---
        function draw() {
            if(canvas.width !== STATE.w || canvas.height !== STATE.h) {
                canvas.width = STATE.w;
                canvas.height = STATE.h;
            }
            const w = STATE.w;
            const h = STATE.h;

            // 1. Background
            ctx.fillStyle = STATE.c1;
            ctx.fillRect(0,0,w,h);

            ctx.save();
            if(STATE.pat === 'gradient') {
                const grd = ctx.createLinearGradient(0,0,w,h);
                grd.addColorStop(0, STATE.c1);
                grd.addColorStop(1, STATE.c2);
                ctx.fillStyle = grd;
                ctx.fillRect(0,0,w,h);
            } 
            else if (STATE.pat === 'blobs') {
                // Base
                ctx.fillStyle = STATE.c1;
                ctx.fillRect(0,0,w,h);
                // Blobs
                STATE.blobs.forEach(b => {
                    ctx.beginPath();
                    ctx.arc(b.x*w, b.y*h, b.r*Math.min(w,h), 0, Math.PI*2);
                    ctx.fillStyle = STATE.c2;
                    ctx.globalAlpha = b.a;
                    ctx.fill();
                });
                ctx.globalAlpha = 1;
                // Soft overlay
                const grd = ctx.createLinearGradient(0,0,0,h);
                grd.addColorStop(0, 'rgba(0,0,0,0)');
                grd.addColorStop(1, 'rgba(0,0,0,0.4)');
                ctx.fillStyle = grd;
                ctx.fillRect(0,0,w,h);
            }
            else if (STATE.pat === 'grid') {
                ctx.strokeStyle = STATE.c2;
                ctx.globalAlpha = 0.15;
                ctx.lineWidth = 1;
                const step = 40;
                for(let x=0; x<=w; x+=step) { ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,h); ctx.stroke(); }
                for(let y=0; y<=h; y+=step) { ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(w,y); ctx.stroke(); }
                ctx.globalAlpha = 1;
            }
            else if (STATE.pat === 'stripes') {
                ctx.strokeStyle = STATE.c2;
                ctx.lineWidth = 40;
                ctx.globalAlpha = 0.1;
                for(let i=-h; i<w; i+=80) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i+h,h); ctx.stroke(); }
                ctx.globalAlpha = 1;
            }
            else if (STATE.pat === 'dots') {
                ctx.fillStyle = STATE.c2;
                const step = 30;
                for(let x=0; x<w; x+=step) for(let y=0; y<h; y+=step) {
                    ctx.globalAlpha = 0.2;
                    ctx.beginPath(); ctx.arc(x,y,2,0,Math.PI*2); ctx.fill();
                }
                ctx.globalAlpha = 1;
            }
            else if (STATE.pat === 'noise') {
                ctx.fillStyle = STATE.c1;
                ctx.fillRect(0,0,w,h);
                for(let i=0; i<400; i++) {
                    ctx.fillStyle = Math.random() > 0.5 ? STATE.c2 : '#fff';
                    ctx.globalAlpha = 0.1;
                    ctx.fillRect(Math.random()*w, Math.random()*h, 2, 2);
                }
                ctx.globalAlpha = 1;
            }
            ctx.restore();

            // 2. Icon
            if(STATE.icon.show) {
                ctx.save();
                const fontSize = STATE.icon.size;
                const ix = (STATE.icon.x / 100) * w;
                const iy = (STATE.icon.y / 100) * h;
                
                ctx.font = `${fontSize}px "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                ctx.shadowColor = 'rgba(0,0,0,0.3)';
                ctx.shadowBlur = 20;
                ctx.shadowOffsetY = 10;
                
                ctx.fillStyle = STATE.icon.color;
                ctx.fillText(STATE.icon.char, ix, iy);
                ctx.restore();
            }

            // 3. Text
            drawTextLayer(STATE.t1, true);
            drawTextLayer(STATE.t2, false);
        }

        function drawTextLayer(t, bold) {
            if(!t.text) return;
            const size = parseInt(t.size);
            const x = (t.x / 100) * STATE.w; 
            const y = (t.y / 100) * STATE.h;

            ctx.save();
            ctx.font = `${bold ? 'bold' : 'normal'} ${size}px "${STATE.font}"`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            const metrics = ctx.measureText(t.text);
            const textW = metrics.width;
            const textH = size; 
            
            if(t.hl) {
                ctx.fillStyle = t.col === '#ffffff' ? 'rgba(0,0,0,0.7)' : 'rgba(255,255,255,0.9)';
                const pad = size * 0.2;
                ctx.fillRect(x - textW/2 - pad, y - textH/2, textW + pad*2, textH);
            }

            ctx.shadowColor = t.hl ? 'transparent' : 'rgba(0,0,0,0.5)';
            ctx.shadowBlur = t.hl ? 0 : 8;
            ctx.shadowOffsetY = t.hl ? 0 : 2;
            
            ctx.fillStyle = t.col;
            ctx.fillText(t.text, STATE.w/2, y); 
            ctx.restore();
        }

        // --- LOGIC ---
        function genBlobs() {
            STATE.blobs = [];
            for(let i=0; i<12; i++) {
                STATE.blobs.push({
                    x: Math.random(), y: Math.random(), 
                    r: Math.random()*0.4 + 0.1, 
                    a: Math.random()*0.3 + 0.05
                });
            }
        }

        // --- UI ACTIONS & BINDING ---
        // Helper to manually trigger input events so listeners fire
        function updateVal(id, val) {
            const el = document.getElementById(id);
            if(el) {
                if(el.type === 'checkbox') el.checked = val;
                else el.value = val;
                el.dispatchEvent(new Event('input'));
            }
        }

        // Action: Apply Theme
        window.applyTheme = (name) => {
            const t = THEMES[name];
            if(!t) return;
            // Update UI & State sequentially
            updateVal('c1', t.c1);
            updateVal('c2', t.c2);
            updateVal('pattern', t.pat);
            updateVal('font', t.font);
            updateVal('tc1', t.t1c);
            updateVal('tc2', t.t2c);
            
            genBlobs();
            draw();
            triggerPop();
        };

        // Action: Remix
        window.remix = () => {
            const keys = Object.keys(THEMES);
            const randTheme = THEMES[keys[Math.floor(Math.random() * keys.length)]];
            
            updateVal('c1', randTheme.c1);
            updateVal('c2', randTheme.c2);
            updateVal('pattern', Math.random() > 0.5 ? randTheme.pat : 'blobs');
            updateVal('font', randTheme.font);
            updateVal('tc1', randTheme.t1c);
            
            const icons = ['üìã','üî•','‚ú®','‚ù§Ô∏è','‚úÖ','üöÄ','‚≠ê','üíª','üéâ'];
            const randIcon = icons[Math.floor(Math.random()*icons.length)];
            updateVal('iconSelect', randIcon);

            genBlobs();
            draw();
            triggerPop();
        };

        function triggerPop() {
            wrapper.classList.remove('animate-pop');
            void wrapper.offsetWidth; // trigger reflow
            wrapper.classList.add('animate-pop');
        }

        window.setSize = (w,h) => {
            updateVal('inpW', w);
            updateVal('inpH', h);
            document.getElementById('dimLabel').innerText = `${w}x${h}`;
        };

        window.setView = (mode) => {
            STATE.view = mode;
            ['raw','phone','laptop'].forEach(m => {
                const btn = document.getElementById('v-'+m);
                btn.className = m === mode 
                    ? "px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider bg-white text-slate-900 transition"
                    : "px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider text-slate-500 hover:text-white transition";
            });

            wrapper.className = "relative shadow-2xl origin-center transition-all duration-500";
            if(mode === 'phone') wrapper.classList.add('device-phone');
            if(mode === 'laptop') wrapper.classList.add('device-laptop');
            fit();
        };

        window.fit = () => {
            const stage = document.getElementById('stage');
            const padding = 60;
            const availW = stage.clientWidth - padding;
            const availH = stage.clientHeight - padding;
            
            let scale = Math.min(availW / STATE.w, availH / STATE.h);
            if(STATE.view !== 'raw') scale *= 0.85;
            
            wrapper.style.transform = `scale(${scale})`;
            
            if(STATE.view !== 'raw') {
                wrapper.style.width = `${STATE.w}px`;
                wrapper.style.height = `${STATE.h}px`;
            } else {
                wrapper.style.width = 'auto';
                wrapper.style.height = 'auto';
            }
        };

        window.download = () => {
            const link = document.createElement('a');
            const fmt = document.getElementById('fmt').value;
            const name = document.getElementById('fname').value || 'freeclipboard';
            link.download = `${name}.${fmt}`;
            link.href = canvas.toDataURL(`image/${fmt}`, 0.9);
            link.click();
        };

        function bindInputs() {
            // General Binder
            // id: HTML Element ID
            // root: Key in STATE object (e.g., 'icon') or 'null' if top level
            // key: Subkey in STATE object (e.g., 'size')
            const bind = (id, rootKey, subKey) => {
                const el = document.getElementById(id);
                if(!el) return;
                
                el.addEventListener('input', (e) => {
                    const val = el.type === 'checkbox' ? el.checked : el.value;
                    
                    if(subKey) {
                        STATE[rootKey][subKey] = val; // e.g., STATE.icon.size
                    } else {
                        STATE[rootKey] = val; // e.g., STATE.c1
                    }

                    // Hex Sync logic
                    if(id==='c1') document.getElementById('hex1').value = val;
                    if(id==='hex1') document.getElementById('c1').value = val;
                    if(id==='c2') document.getElementById('hex2').value = val;
                    if(id==='hex2') document.getElementById('c2').value = val;
                    
                    if(id==='pattern' && val==='blobs') genBlobs();
                    draw();
                });
            };

            // Canvas Size
            document.getElementById('inpW').addEventListener('input', (e) => { STATE.w = parseInt(e.target.value); draw(); fit(); });
            document.getElementById('inpH').addEventListener('input', (e) => { STATE.h = parseInt(e.target.value); draw(); fit(); });

            // Background
            bind('c1', 'c1'); 
            bind('hex1', 'c1'); 
            bind('c2', 'c2'); 
            bind('hex2', 'c2'); 
            bind('pattern', 'pat');

            // Icon
            document.getElementById('showIcon').addEventListener('change', (e) => {
                 STATE.icon.show = e.target.checked;
                 document.getElementById('iconControls').style.opacity = e.target.checked ? '1' : '0.3';
                 draw();
            });
            bind('iconSelect', 'icon', 'char');
            bind('iconColor', 'icon', 'color');
            bind('iconSize', 'icon', 'size');
            bind('iconX', 'icon', 'x');
            bind('iconY', 'icon', 'y');

            // Typography
            bind('font', 'font');
            // Text 1
            bind('t1', 't1', 'text'); 
            bind('tc1', 't1', 'col'); 
            bind('ts1', 't1', 'size'); 
            bind('ty1', 't1', 'y'); 
            bind('th1', 't1', 'hl');
            // Text 2
            bind('t2', 't2', 'text'); 
            bind('tc2', 't2', 'col'); 
            bind('ts2', 't2', 'size'); 
            bind('ty2', 't2', 'y'); 
            bind('th2', 't2', 'hl');
        }

        init();
    </script>
</body>
</html>

